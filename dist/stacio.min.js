var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a,b){if(b){var c=ba;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}
ca("Math.hypot",function(a){return a?a:function(a,c,d){a=Number(a);c=Number(c);var b,f=Math.max(Math.abs(a),Math.abs(c));for(b=2;b<arguments.length;b++)f=Math.max(f,Math.abs(arguments[b]));if(1E100<f||1E-100>f){if(!f)return f;a/=f;c/=f;var h=a*a+c*c;for(b=2;b<arguments.length;b++){var m=Number(arguments[b])/f;h+=m*m}return Math.sqrt(h)*f}h=a*a+c*c;for(b=2;b<arguments.length;b++)m=Number(arguments[b]),h+=m*m;return Math.sqrt(h)}});function g(a,b,c,d){this.D=a;this.F=b;this.H=a+c;this.I=b+d;this.left=this.D;this.top=this.F;this.width=c;this.height=d;this.i=function(){return{x:(this.D+this.H)/2|0,y:(this.F+this.I)/2|0}};this.c=function(a){return this.D<=a.H&&this.H>=a.D&&this.F<=a.I&&this.I>=a.F}};function da(){this.g=!1;this.u=this.f=0}da.prototype.update=function(){this.g?(this.f++,this.u=0):(this.f=0,this.u++)};function ea(a){this.keys=Array(256);for(var b=0;256>b;b++)this.keys[b]=new da;a.tabIndex=0;var c=this;a.addEventListener("keydown",function(a){ha(c,a,!0)});a.addEventListener("keyup",function(a){ha(c,a,!1)})}ea.prototype.update=function(){for(var a=0;256>a;a++)this.keys[a].update()};function ha(a,b,c){b.stopPropagation();b.preventDefault();b=b.keyCode;0<=b&&256>b&&(a.keys[b].g=c)};function ia(a){this.c=a;this.B=this.A=this.y=this.x=0;this.g=!1;this.u=this.f=0;var b=this.o.bind(this);a.addEventListener("mousedown",b);a.addEventListener("mouseup",b);a.addEventListener("mousemove",b);a.addEventListener("contextmenu",b);b=this.w.bind(this);a.addEventListener("touchstart",b);a.addEventListener("touchend",b);a.addEventListener("touchcancel",b);a.addEventListener("touchmove",b)}ia.prototype.update=function(){this.g?(this.f++,this.u=0):(this.f=0,this.u++)};
ia.prototype.o=function(a){a.stopPropagation();a.preventDefault();ja(this,a.clientX,a.clientY);"mousedown"===a.type&&(this.g=!0,this.c.focus());"mouseup"===a.type&&(this.g=!1)};ia.prototype.w=function(a){a.stopPropagation();a.preventDefault();0<a.touches.length?(a=a.touches[0],ja(this,a.clientX,a.clientY),this.g=!0):this.g=!1};
function ja(a,b,c){var d=a.c.getBoundingClientRect(),e=d.width/d.height;if(.01<e-ka){var f=ka*d.height;d=new g(Math.floor((d.width-f)/2),0,f,d.height)}-.01>e-ka&&(e=d.width/ka,d=new g(0,Math.floor((d.height-e)/2),d.width,e));e=a.x;f=a.y;a.x=k*(b-d.left)/d.width|0;a.y=p*(c-d.top)/d.height|0;a.A=a.x-e;a.B=a.y-f}function la(a,b){return q.x>=a&&q.x<a+80&&q.y>=b&&q.y<b+8};var ma=[0,-1,1,0],na=[-1,0,0,1],oa=[1,1,1,1];
function pa(a){for(var b=r.target,c=u,d=0;d<c.height;d++)for(var e=0;e<c.width;e++){var f=c.a[d][e];f.G=Infinity;f.aa=Math.min(Math.abs(e-b.x),Math.abs(d-b.y));f.fa=null}a=u.a[a.y][a.x];a.G=0;for(a=[a];0<a.length;){c=null;d=-1;e=Infinity;for(f=0;f<a.length;f++){var h=a[f];Infinity!==h.G&&h.G+h.aa<e&&(c=h,d=f,e=h.G+h.aa)}a.splice(d,1);if(c.x===b.x&&c.y===b.y){b=[];for(a=c;a;)b.push(a),a=a.fa;b.reverse();return b}for(d=0;d<ma.length;d++)if(e=c.x+ma[d],f=c.y+na[d],0<=e&&e<u.width&&0<=f&&f<u.height){h=
u.a[f][e];var m=c.G+oa[d];m<h.G&&20>=m&&!u.a[f][e].s&&(h.G=m,h.fa=c,a.push(h))}}return null};function qa(a,b,c){b=ra(a,a.VERTEX_SHADER,b);c=ra(a,a.FRAGMENT_SHADER,c);var d=a.createProgram();a.attachShader(d,b);a.attachShader(d,c);a.linkProgram(d);return d}function ra(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);return b}
function sa(a){var b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);var c=a.RGBA,d=a.RGBA,e=a.UNSIGNED_BYTE;a.texImage2D(a.TEXTURE_2D,0,c,1,1,0,d,e,new Uint8Array([0,0,0,0]));var f=new Image;f.onload=function(){a.bindTexture(a.TEXTURE_2D,b);a.texImage2D(a.TEXTURE_2D,0,c,d,e,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,
a.NEAREST);a.generateMipmap(a.TEXTURE_2D);b.loaded=!0;b.width=f.width;b.height=f.height};f.src="img/graphics.png";return b};function ta(a,b){this.x=a;this.y=b;this.la=0;this.s=!0;this.ga=this.visible=!1;this.aa=this.G=0;this.fa=null}function ua(){this.height=this.width=256;this.ha=null;this.K=new Uint8Array(262144);this.ua=new Float32Array([256,256]);this.clear()}ua.prototype.clear=function(){for(var a=0;a<this.K.length;a++)this.K[a]=255};
ua.prototype.ba=function(a){this.ha=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.ha);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,this.K);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)};
function va(){this.height=this.width=256;this.a=Array(256);this.o=Array(3);this.ea=new Float32Array(2);for(var a=0;256>a;a++){this.a[a]=Array(256);for(var b=0;256>b;b++)this.a[a][b]=new ta(b,a)}for(a=0;3>a;a++)this.o[a]=new ua}
va.prototype.ba=function(a){this.ca=a;this.oa=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.oa);a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,-1,0,1,1,1,1,0,-1,1,0,0]),a.STATIC_DRAW);this.c=qa(a,"precision highp float;attribute vec2 position;attribute vec2 texture;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 viewOffset;uniform vec2 viewportSize;uniform vec2 mapSize;void main(void) {   pixelCoord = (texture * viewportSize) + viewOffset;   texCoord = pixelCoord / mapSize / 16.0;   gl_Position = vec4(position, 0.0, 1.0);}","precision highp float;varying vec2 pixelCoord;varying vec2 texCoord;uniform sampler2D tiles;uniform sampler2D sprites;void main(void) {   vec4 tile = texture2D(tiles, texCoord);   if(tile.x == 1.0 && tile.y == 1.0) { discard; }   vec2 spriteOffset = floor(tile.xy * 256.0) * 16.0;   vec2 spriteCoord = mod(pixelCoord, 16.0);   gl_FragColor = texture2D(sprites, (spriteOffset + spriteCoord) / 1024.0);   gl_FragColor.a = tile.a;}");
this.na=a.getAttribLocation(this.c,"position");this.ia=a.getAttribLocation(this.c,"texture");this.ta=a.getUniformLocation(this.c,"viewportSize");this.sa=a.getUniformLocation(this.c,"viewOffset");this.pa=a.getUniformLocation(this.c,"mapSize");this.ra=a.getUniformLocation(this.c,"tiles");this.qa=a.getUniformLocation(this.c,"sprites");for(var b=0;b<this.o.length;b++)this.o[b].ba(a)};
function w(a,b,c,d){var e=u;e.a[b][a].la=c;e.a[b][a].s=d;d=e.o[0];a=4*(b*d.width+a);d.K[a]=0===c?255:(c-1)%64|0;d.K[a+1]=0===c?255:(c-1)/64|0}function x(a,b,c){return 0>b||b>=a.width||0>c||c>=a.height?null:a.a[c][b]}function wa(a,b){return(a=x(u,a,b))?a.la:81}function z(a,b){a=x(u,a,b);return!a||a.s}va.prototype.da=function(a,b){return(a=x(this,a,b))&&a.visible};va.prototype.da=function(a,b){return a<this.W||a>this.w||b<this.X||b>this.M?!1:this.a[b][a].visible};function xa(){var a=u,b=r.x/16|0,c=r.y/16|0;a.ka=b;a.ma=c;a.W=Math.max(0,b-12);a.X=Math.max(0,c-12);a.w=Math.min(a.width-1,b+12);a.M=Math.min(a.height-1,c+12);for(var d=a.X;d<=a.M;d++)for(var e=a.W;e<=a.w;e++)a.a[d][e].ga|=a.a[d][e].visible,a.a[d][e].visible=!1;a.a[c][b].visible=!0;ya(a,1,1);za(a,1,1);ya(a,1,-1);za(a,1,-1);ya(a,-1,1);za(a,-1,1);ya(a,-1,-1);za(a,-1,-1)}
function ya(a,b,c){var d=[],e=[],f=1,h=0,m=0,v=0,l,n;for(n=a.ma+c;n>=a.X&&n<=a.M;n+=c,m=h,++f){var O=.5/f;var y=-1;var P=Math.floor(v*f+.5);for(l=a.ka+P*b;P<=f&&l>=a.W&&l<=a.w;l+=b,++P,y=E){var K=!0;var fa=!1;var U=P/f;var E=U+O;if(0<m)if(a.a[n-c][l].visible&&!a.a[n-c][l].s||a.a[n-c][l-b].visible&&!a.a[n-c][l-b].s)for(var t=0;t<m&&K;++t){if(y<=e[t]&&E>=d[t])if(a.a[n][l].s)if(y>=d[t]&&E<=e[t]){K=!1;break}else d[t]=Math.min(d[t],y),e[t]=Math.max(e[t],E),fa=!0;else if(U>d[t]&&U<e[t]){K=!1;break}}else K=
!1;K&&(a.a[n][l].visible=!0,a.a[n][l].s&&(v>=y?v=E:fa||(d[h]=y,e[h++]=E)))}}}
function za(a,b,c){var d=[],e=[],f=1,h=0,m=0,v=0,l,n;for(l=a.ka+b;l>=a.W&&l<=a.w;l+=b,m=h,++f){var O=.5/f;var y=-1;var P=Math.floor(v*f+.5);for(n=a.ma+P*c;P<=f&&n>=a.X&&n<=a.M;n+=c,++P,y=E){var K=!0;var fa=!1;var U=P/f;var E=U+O;if(0<m)if(a.a[n][l-b].visible&&!a.a[n][l-b].s||a.a[n-c][l-b].visible&&!a.a[n-c][l-b].s)for(var t=0;t<m&&K;++t){if(y<=e[t]&&E>=d[t])if(a.a[n][l].s)if(y>=d[t]&&E<=e[t]){K=!1;break}else d[t]=Math.min(d[t],y),e[t]=Math.max(e[t],E),fa=!0;else if(U>d[t]&&U<e[t]){K=!1;break}}else K=
!1;K&&(a.a[n][l].visible=!0,a.a[n][l].s&&(v>=y?v=E:fa||(d[h]=y,e[h++]=E)))}}};var Aa=null,Ba=null,Ca=null,Da=null,Ea=null,Fa=new Float32Array(2),Ga=null,Ha=null,Ia=null,A=null,B=new Float32Array(65536),C=0,D=new Float32Array(65536),F=0,Ja=new Uint8Array(65536),Ka=new DataView(Ja.buffer),La=0;function G(a,b,c,d){a=a.split("\n");for(var e=0;e<a.length;e++)for(var f=0;f<a[e].length;f++){var h=a[e].charCodeAt(f);33<=h&&127>=h&&H(b+4*f,c+8*e,8*(h-33),0,8,10,d)}}
function H(a,b,c,d,e,f,h,m,v){if(A.loaded){m=a+Math.abs(void 0!==m?m:e);v=b+(void 0!==v?v:f);var l=c/A.width,n=d/A.height;c=(c+e)/A.width;d=(d+f)/A.height;h=h||0;B[C++]=a;B[C++]=b;B[C++]=m;B[C++]=b;B[C++]=a;B[C++]=v;D[F++]=l;D[F++]=n;D[F++]=c;D[F++]=n;D[F++]=l;D[F++]=d;B[C++]=a;B[C++]=v;B[C++]=m;B[C++]=b;B[C++]=m;B[C++]=v;D[F++]=l;D[F++]=d;D[F++]=c;D[F++]=n;D[F++]=c;D[F++]=d;for(a=0;6>a;a++)Ka.setUint32(La,h,!1),La+=4}};function Ma(){var a=document.querySelector("canvas"),b=a.getContext("webgl",{alpha:!1,antialias:!1});if(b){this.c=a;this.options={};this.ca=b;b.disable(b.DEPTH_TEST);b.enable(b.BLEND);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);Aa=qa(b,"uniform vec2 u_viewportSize;attribute vec2 a_position;attribute vec2 a_texCoord;attribute vec4 a_color;varying vec2 v_texCoord;varying vec4 v_color;void main() {vec2 zeroToOne = a_position / u_viewportSize;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;v_color = a_color;}",
"precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;varying vec4 v_color;void main() {gl_FragColor = texture2D(u_image, v_texCoord);if (gl_FragColor.a < 0.1) discard;if (v_color.a > 0.5) gl_FragColor = v_color;}");Ga=b.createBuffer();Ha=b.createBuffer();Ia=b.createBuffer();Ba=b.getUniformLocation(Aa,"u_viewportSize");Ca=b.getAttribLocation(Aa,"a_position");Da=b.getAttribLocation(Aa,"a_texCoord");Ea=b.getAttribLocation(Aa,"a_color");A=sa(b);this.w=new ea(a);this.keys=this.w.keys;
this.M=new ia(a);u=new va;I=[];J=[];Na=[];for(a=0;4>a;a++){J.push(Array(4));for(var c=0;4>c;c++)J[a][c]=null}for(a=0;10>a;a++){c={level:a,x:0,y:0,parent:null,J:0,children:[],Y:[]};if(0===a)c.x=Math.floor(4*Math.random()),c.y=Math.floor(4*Math.random());else{var d=Na[Math.floor(Math.random()*Na.length)];d.children.push(c);d.J--;c.parent=d;0<d.x&&!J[d.y][d.x-1]&&(c.x=d.x-1,c.y=d.y);0<d.y&&!J[d.y-1][d.x]&&(c.x=d.x,c.y=d.y-1);3>d.x&&!J[d.y][d.x+1]&&(c.x=d.x+1,c.y=d.y);3>d.y&&!J[d.y+1][d.x]&&(c.x=d.x,
c.y=d.y+1)}c.rect=new g(40*c.x,40*c.y,40,40);I.push(c);J[c.y][c.x]=c;Na=[];for(c=0;c<I.length;c++)d=I[c],d.J=0,0<d.x&&!J[d.y][d.x-1]&&d.J++,0<d.y&&!J[d.y-1][d.x]&&d.J++,3>d.x&&!J[d.y][d.x+1]&&d.J++,3>d.y&&!J[d.y+1][d.x]&&d.J++,0<d.J&&Na.push(d)}for(a=0;a<I.length;a++){c=I[a];d=c.Y;var e=new g(c.rect.D+1,c.rect.i().y-2,5,5);Oa(e);d.push(e);e=new g(c.rect.H-5,c.rect.i().y-2,5,5);Oa(e);d.push(e);e=new g(c.rect.i().x-2,c.rect.F+1,5,5);Oa(e);d.push(e);e=new g(c.rect.i().x-2,c.rect.I-5,5,5);Oa(e);for(d.push(e);10>
d.length;){e=new g(L(c.rect.D+2,c.rect.H-12-3),L(c.rect.F+2,c.rect.I-8-3),L(5,12),L(5,8));for(var f=!1,h=0;h<d.length;h++)if(e.c(d[h])){f=!0;break}f||(Oa(e),d.push(e))}for(e=d.length-1;0<e;e--)h=Math.floor(Math.random()*(e+1)),f=d[e],d[e]=d[h],d[h]=f;for(e=1;e<d.length;e++)f=d[e].i(),h=d[e-1].i(),.5>Math.random()?(Pa(h.x,f.x,h.y),Qa(h.y,f.y,f.x)):(Qa(h.y,f.y,h.x),Pa(h.x,f.x,f.y));c.parent&&(c.parent.x<c.x?Pa(c.rect.D-3,c.rect.D+3,c.rect.i().y):c.parent.x>c.x?Pa(c.rect.H-3,c.rect.H+3,c.rect.i().y):
c.parent.y<c.y?Qa(c.rect.F-3,c.rect.F+3,c.rect.i().x):c.parent.y>c.y&&Qa(c.rect.I-3,c.rect.I+3,c.rect.i().x))}for(a=0;256>a;a++)for(c=0;256>c;c++)z(c,a)&&(z(c,a+1)?0!==wa(c,a)&&0===wa(c,a+1)?w(c,a,Ra(c,a),!0):z(c,a-1)&&z(c-1,a)&&z(c+1,a)&&z(c-1,a-1)&&z(c+1,a-1)&&z(c-1,a+1)&&z(c+1,a+1)||(d=Sa(c,a),d=64*(1+(d?d.level:0)%6)+23,w(c,a,L(d,d+6),!0)):w(c,a,Ra(c,a),!0));r={b:0,name:"Player",x:16*I[0].Y[0].i().x,y:16*I[0].Y[0].i().y,A:0,B:0,direction:2,h:100,T:100,m:1,v:0,C:2,target:null,path:null,R:0,V:100,
ja:100,L:0,N:10,level:1};a={b:4,name:"Radio",x:r.x+32,y:r.y-32};c={b:2,name:"Blaster",x:r.x+32,y:r.y+32};M=[r];N=[a,c];Ta=[];Q=[];R={x:0,y:0};S=null;for(a=0;a<I.length;a++)for(c=I[a],d=c.Y,e=1;e<d.length;e++){f=d[e].i();h=c.level/3|1;for(var m=0;m<h;m++){var v=Ua(f.x,f.y);if(!v)break;M.push({b:1,level:c.level+1,name:"Alien ("+(c.level+1)+")",x:16*v.Z,y:16*v.$,A:0,B:0,direction:2,h:10+5*c.level,T:10+5*c.level,m:1,v:0,C:4})}8===e&&N.push({b:3,name:"Blue Key",x:16*f.x+32,y:16*f.y+32})}xa();Va(Wa[4]);
u.ba(b);window.addEventListener("resize",this.o.bind(this),!1);this.o();requestAnimationFrame(Xa)}}Ma.prototype.o=function(){var a=window.innerWidth,b=window.innerHeight;var c=a>b?Math.max(1,Math.min(Math.floor(a/256),Math.floor(b/144))):Math.max(1,Math.min(Math.floor(a/144),Math.floor(b/256)));k=Math.round(a/c);p=Math.round(b/c);ka=k/p;this.c.width=k;this.c.height=p;this.c.style.left="0";this.c.style.top="0";this.c.style.width=a+"px";this.c.style.height=b+"px"};var k=256,p=144,ka=k/p,Ya=[0,0,16,17,23],Za=[1,5,28,23,27],$a=[2,0,1,3];var u=null,I=null,J=null,Na=null;function Oa(a){var b=a.D,c=a.H,d=a.I;for(a=a.F;a<d;a++)for(var e=b;e<c;e++)w(e,a,ab(e,a),!1)}function Pa(a,b,c){for(var d=Math.min(a,b);d<=Math.max(a,b);d++)w(d,c,ab(d,c),!1)}function Qa(a,b,c){for(var d=Math.min(a,b);d<=Math.max(a,b);d++)w(c,d,ab(c,d),!1)}function L(a,b){return Math.floor(Math.random()*(b-a)+a)}function Sa(a,b){a=a/40|0;b=b/40|0;return 0>a||4<=a||0>b||4<=b?null:J[b][a]}
function ab(a,b){a=(a=Sa(a,b))?a.level:0;a=1+64*(9+a%3)+(5>a?16:20);return L(a,a+4)}function Ra(a,b){a=Sa(a,b);a=64*(1+(a?a.level:0)%6)+17;return L(a,a+6)};var bb=[{j:"Ok hotshot, teleportation complete.\nSystem check. Do you remember the mission?",options:[{text:"ROGER",l:"dialog",O:4},{text:"UH WHAT?",l:"dialog",O:1}]},{j:"Mother frakking... Teleportation glitch.\nYou're a lost cause. Want advice anyway?",options:[{text:"YES",l:"dialog",O:2},{text:"NO",l:"dialog",O:3}]},{j:"Alright.  Your brain is mush, but we'll try.\nFind the blaster in the room.",options:[{text:"COPY",l:"quest",U:0}]},{j:"Alright.  Your brain is mush, and you're\nballs deep in aliens who want to kill you.  Good luck.",
options:[{text:"BYE"}]},{j:"Good. How do you wanna run this, soldier?\nWant me to guide you, or comms off?",options:[{text:"GUIDE",l:"dialog",O:5},{text:"COMMS OFF",l:"dialog",O:6}]},{j:"Alright.  First things first:\nFind the blaster in the room.",options:[{text:"OK",l:"quest",U:0}]},{j:"Alright.  You know what you're doing.\nGo get em.",options:[{text:"OVER AND OUT"}]},{j:"Good.  Radar shows alien blood nearby.\nGo kill that ugly bastard.",options:[{text:"ACCEPT",l:"quest",U:1},{text:"IGNORE"}]},
{j:"Not bad, soldier.  That took guts.\nFind a BLUE key to get out of this sector.",options:[{text:"ACCEPT",l:"quest",U:2},{text:"IGNORE"}]},{j:"Excellent.  Let's get the frak out of here.\nFind the BLUE door to move to the next sector.",options:[{text:"ACCEPT",l:"quest",U:3},{text:"IGNORE"}]}],T=!1,cb=0,db=0,eb;var Wa=[{title:"Find blaster",P:"item",b:2,S:7},{title:"First blood",P:"kill",b:1,S:8},{title:"Blue keycard",P:"item",b:3,S:9},{title:"Blue door",P:"item",b:3,S:9},{title:"Pick up radio",P:"item",b:4,S:0}],V=[];function Va(a){fb("Quest accepted: "+a.title,4294902015);V.push(a)}function gb(a){fb("Quest complete: "+a.title,4294902015);void 0!==a.S&&(a=a.S,T=!0,eb=!1,cb=a,db=hb)};var W=null,ib=0,jb=0,X=0,hb=0,r=null,M=null,N=null,Ta=null,Q=null,R=null,S=null,kb=!1,lb=!1,mb=0,nb=0,ob=0,pb=0,qb=null,Y=null,q=null,rb=[],sb=0;function tb(a){return a.x+16>=R.x&&a.y+16>=R.y&&a.x<R.x+k&&a.y<R.y+p&&u.da(a.x/16|0,a.y/16|0)}function ub(a,b){for(var c=0;c<M.length;c++){var d=M[c];if(!(0>=d.h)&&(d.x/16|0)===a&&(d.y/16|0)===b)return d}return null}
function Ua(a,b){for(var c=0;20>c;c++){for(var d=a-c;d<=a+c;d++){var e=b-c;if(!z(d,e)&&null===ub(d,e))return{Z:d,$:e};e=b+c;if(!z(d,e)&&null===ub(d,e))return{Z:d,$:e}}for(d=b-c;d<=b+c;d++){e=a-c;if(!z(e,d)&&null===ub(e,d))return{Z:e,$:d};e=a+c;if(!z(e,d)&&null===ub(e,d))return{Z:e,$:d}}}return null}
function Z(a,b,c,d){a.direction=d;var e=Math.hypot(b,c);d=Math.floor(a.x/16)+b/e;e=Math.floor(a.y/16)+c/e;if(z(d,e))return!1;if(d=ub(d,e)){if(a.b===d.b)return!1;vb(a,d,2);a.v=18;rb.push({x:d.x,y:d.y,frame:0});return!0}a.A=b;a.B=c;a.v=16/Math.max(Math.abs(b),Math.abs(c));return!0}
function vb(a,b,c){b.h-=c;if(0>=b.h&&(b.h=0,fb(b.name+" died",4278190335),b===S&&(S=null),0===a.b)){for(r.L+=10*b.level;r.L>=r.N;)r.L-=r.N,r.N*=2,r.level++,fb("You are now level "+r.level,16711935);for(a=V.length-1;0<=a;a--)c=V[a],"kill"===c.P&&c.b===b.b&&(V.splice(a,1),gb(c))}}function fb(a,b){Q.push({text:a,color:b});5<Q.length&&Q.splice(0,Q.length-5)}
function wb(){0===X&&M.sort(function(a,c){return Math.hypot(a.x-r.x,a.y-r.y)-Math.hypot(c.x-r.x,c.y-r.y)});X++;if(X>=M.length)for(var a=X=0;a<M.length;a++)0<M[a].h&&(M[a].m=1)}function xb(a){if(T){var b=bb[cb];0>a||a>b.options.length||(a=b.options[a],"dialog"===a.l?(a=a.O,T=!0,eb=!1,cb=a,db=hb):"quest"===a.l?(T=!1,Va(Wa[a.U])):T=!1)}}
function Xa(){qb.update();q.update();if(T){if(!(30>hb-db)){var a=(k-160)/2|0,b=(p-160)/2|0;1===Y[32].u?eb=!0:1===Y[49].u||1===q.u&&la(a,b+64)?xb(0):(1===Y[50].u||1===q.u&&la(a,b+80))&&xb(1)}}else if(kb)1===Y[78].f&&(kb=!1);else if(0<r.h)for(;;){a=M[X];if(0<a.m&&0===a.v)if(0===X)a:if(0>=r.h)r.m=0;else{var c=r.x/16|0;b=r.y/16|0;var d=!1;if(0!==q.A||0!==q.B)mb=q.x,nb=q.y,ob=(R.x+mb)/16|0,pb=(R.y+nb)/16|0;if(lb){1===Y[98].f||1===Y[40].f?(nb+=16,pb++):1===Y[100].f||1===Y[37].f?(mb-=16,ob--):1===Y[102].f||
1===Y[39].f?(mb+=16,ob++):1===Y[104].f||1===Y[38].f?(nb-=16,pb--):1===Y[27].f?(r.target=null,r.path=null,lb=!1):1===Y[13].f&&(lb=!1);var e=x(u,ob,pb);e!==r.target&&(b={x:c,y:b},r.target=e,r.path=pa(b),r.R=0)}else{if(q.g)if(q.y>p-24)0<=q.x&&32>q.x&&(d=!0);else{e=ob;var f=pb;if(S=ub(e,f)){r.target=null;r.path=null;break a}e=x(u,e,f);e!==r.target&&(b={x:c,y:b},r.target=e,r.path=pa(b),r.R=0);break a}if(1===Y[9].f){b=S?M.indexOf(S):0;for(c=b+1;0===c||c>=M.length||0>=M[c].h||!tb(M[c]);)if(c++,c>=M.length&&
(c=0),c===b){c=-1;break}0<c?S=M[c]:S=null}else if(1===Y[13].f)mb=r.x-R.x,nb=r.y-R.y,ob=r.x/16|0,pb=r.y/16|0,lb=!0;else if(1===Y[78].f)kb=!0;else{e=null;if(r.path){for(e=r.path[r.R];e&&e.x===c&&e.y===b;)r.R++,e=r.R<r.path.length?r.path[r.R]:null;e||(r.target=null,r.path=null)}f=Y[100].g||Y[37].g||e&&e.x<c;c=Y[102].g||Y[39].g||e&&e.x>c;var h=Y[104].g||Y[38].g||e&&e.y<b,m=Y[101].g;d=1===Y[49].f||d;Y[98].g||Y[40].g||e&&e.y>b?Z(r,0,r.C,2):f?Z(r,-r.C,0,3):m?r.m=0:c?Z(r,r.C,0,1):h?Z(r,0,-r.C,0):d&&S&&0<
r.V&&(rb.push({x:S.x,y:S.y,frame:0}),r.v=36,vb(r,S,5),r.V--)}}}else 0>=a.h?a.m=0:tb(a)?r.x<a.x&&Z(a,-a.C,0,3)||r.x>a.x&&Z(a,a.C,0,1)||r.y<a.y&&Z(a,0,-a.C,0)||r.y>a.y&&Z(a,0,a.C,2)||0!==a.A||0!==a.B||(a.m=0):a.m=0;if(0<a.v){if(0!==a.A||0!==a.B)a.x+=a.A,a.y+=a.B;a.v--;if(0===a.v&&(a.A=0,a.B=0,a.m--,0===a.b)){for(b=N.length-1;0<=b;b--)if(c=N[b],c.x===a.x&&c.y===a.y)for(N.splice(b,1),Ta.push(c),fb("Picked up: "+c.name,16777215),e=V.length-1;0<=e;e--)f=V[e],"item"===f.P&&f.b===c.b&&(V.splice(e,1),gb(f));
xa()}}0>=a.m&&(a.m=0,wb());if(0===X&&0<a.m)break;if(0<a.v)break}Y[65].g&&(sb=10);jb++;16<jb&&(jb=0,ib++);W.viewport(0,0,k,p);W.clearColor(0,0,0,1);W.clear(W.COLOR_BUFFER_BIT|W.DEPTH_BUFFER_BIT);if(A&&A.loaded){R.x=Math.max(0,r.x-(k/2|0)+8);R.y=Math.max(0,r.y-(p/2|0)+8);0<sb--&&(R.x+=4*Math.random()-2,R.y+=4*Math.random()-2);La=F=C=0;if(T){if(T&&(a=(k-160)/2|0,b=(p-160)/2|0,H(a+64,b,128,608,32,32),c=bb[cb],e=hb-db,e=eb?c.j.length:Math.min(c.j.length,Math.floor(e/2)),G(c.j.substr(0,e),a,b+32),e===c.j.length))for(e=
0;e<c.options.length;e++)G(c.options[e].text,a,b+64+16*e)}else{a=u;b=R.x;c=R.y;h=k;m=p;if(A.loaded){e=a.ca;e.enable(e.BLEND);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);e.useProgram(a.c);e.bindBuffer(e.ARRAY_BUFFER,a.oa);e.enableVertexAttribArray(a.na);e.enableVertexAttribArray(a.ia);e.vertexAttribPointer(a.na,2,e.FLOAT,!1,16,0);e.vertexAttribPointer(a.ia,2,e.FLOAT,!1,16,8);a.ea[0]=h;a.ea[1]=m;e.uniform2fv(a.ta,a.ea);e.activeTexture(e.TEXTURE0);e.uniform1i(a.qa,0);e.activeTexture(e.TEXTURE1);e.uniform1i(a.ra,
1);f=b/16|0;d=c/16|0;h=(b+h)/16|0;m=(c+m)/16|0;for(var v=0;v<a.o.length;v++){for(var l=a.o[v],n=d;n<=m;n++)for(var O=f;O<=h;O++){var y=a.da(O,n)?255:(y=x(a,O,n))&&y.ga?144:0;l.K[4*(n*l.width+O)+3]=y}e.uniform2f(a.sa,b,c);e.uniform2fv(a.pa,l.ua);e.bindTexture(e.TEXTURE_2D,l.ha);e.texSubImage2D(e.TEXTURE_2D,0,0,0,l.width,l.height,e.RGBA,e.UNSIGNED_BYTE,l.K);e.drawArrays(e.TRIANGLES,0,6)}}r.target&&(a=16*r.target.x-R.x,b=16*r.target.y-R.y,c=640,z(r.target.x,r.target.y)&&(c=688),H(a,b,c,176,16,16));for(a=
0;a<N.length;a++)b=N[a],tb(b)&&H(b.x-R.x,b.y-R.y,16*Ya[b.b],16*Za[b.b],16,16);for(a=0;a<M.length;a++)b=M[a],tb(b)&&(c=b.x-R.x,e=b.y-R.y,0>=b.h?(f=496,d=432):(f=16*(Ya[b.b]+$a[b.direction]),d=16*(Za[b.b]+ib%2)),b===S&&H(c,e,720,176,16,16),H(c,e,f,d,16,16));for(a=rb.length-1;0<=a;a--)b=rb[a],H(b.x-R.x,b.y-R.y,128+16*Math.floor(b.frame/6),304,16,16),b.frame++,18<=b.frame&&rb.splice(a,1);for(b=a=0;b<M.length;b++)c=M[b],c!==r&&0>=c.h||!tb(c)||(c===r?(e=c.h/c.T,G(c.name,0,a),H(0,a+7,544,208,32,12),H(2,
a+9,544,224,8,8,void 0,Math.round(28*e)),G(c.h+"/"+c.T,0,a+10),e=r.V/r.ja,G("AMMO",32,a),H(32,a+7,544,208,32,12),H(34,a+9,552,224,8,8,void 0,Math.round(28*e)),G(c.V+"/"+c.ja,32,a+10),e=r.L/r.N,G("LEVEL "+r.level,64,a),H(64,a+7,544,208,32,12),H(66,a+9,568,224,8,8,void 0,Math.round(28*e)),G(c.L+"/"+c.N,64,a+10)):(e=c.h/c.T,G(c.name,0,a),H(0,a+7,544,208,32,12),H(2,a+9,560,224,8,8,void 0,Math.round(28*e)),G(c.h+"/"+c.T,0,a+10)),a+=24);if(0<V.length)for(G("OBJECTIVES:",k-60,0),a=0;a<V.length;a++)G(V[a].title,
k-60,8+8*a);a=p-24-8*Q.length;for(b=0;b<Q.length;b++)G(Q[b].text,0,a+8*b,Q[b].color);for(a=0;6>a;a++)H(24*a,p-24,512,208,24,24),0===a&&H(24*a+4,p-24+4,256,448,16,16);kb&&(H(0,0,512,256,144,144,128,k,p),a=(k-144)/2|0,b=(p-144)/2|0,H(a,b,512,256,144,144),H(a+10,b+9,480,416,16,16),G("2",a+21,b+19,16711935),H(a+22,b+33,464,416,16,16),G("0",a+33,b+43,16711935),H(a+22,b+57,624,160,16,16),G("0",a+33,b+67,16711935),H(a+22,b+81,448,416,16,16),G("0",a+33,b+91,16711935),H(a+56,b+9,336,416,16,16),G("0",a+67,
b+19,16711935),H(a+68,b+33,336,448,16,16),G("0",a+79,b+43,16711935),H(a+68,b+57,272,400,16,16),G("0",a+79,b+67,16711935),H(a+68,b+81,400,432,16,16),G("0",a+79,b+91,16711935),H(a+102,b+9,128,354,16,16),G("0",a+113,b+19,16711935),H(a+114,b+33,592,160,16,16),G("0",a+125,b+43,16711935),H(a+114,b+57,272,400,16,16),G("0",a+125,b+67,16711935),H(a+114,b+81,352,400,16,16),G("0",a+125,b+91,16711935),G("1: Leap 2 squares",a+8,b+106,4294967295),G("2: Leap 3 squares",a+8,b+114,4294967295),G("3: Leap 4 squares",
a+8,b+122,16711935),G("4: Leap 5 squares",a+8,b+130,2155905279))}A.loaded&&(W.useProgram(Aa),Fa[0]=k,Fa[1]=p,W.uniform2fv(Ba,Fa),W.activeTexture(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,A),W.enableVertexAttribArray(Ca),W.bindBuffer(W.ARRAY_BUFFER,Ga),W.bufferData(W.ARRAY_BUFFER,B,W.DYNAMIC_DRAW),W.vertexAttribPointer(Ca,2,W.FLOAT,!1,0,0),W.enableVertexAttribArray(Da),W.bindBuffer(W.ARRAY_BUFFER,Ha),W.bufferData(W.ARRAY_BUFFER,D,W.DYNAMIC_DRAW),W.vertexAttribPointer(Da,2,W.FLOAT,!1,0,0),W.enableVertexAttribArray(Ea),
W.bindBuffer(W.ARRAY_BUFFER,Ia),W.bufferData(W.ARRAY_BUFFER,Ja,W.DYNAMIC_DRAW),W.vertexAttribPointer(Ea,4,W.UNSIGNED_BYTE,!0,0,0),W.drawArrays(W.TRIANGLES,0,C/2));hb++}requestAnimationFrame(Xa)}var yb=new Ma;qb=yb.w;Y=yb.keys;W=yb.ca;q=yb.M;requestAnimationFrame(Xa);
