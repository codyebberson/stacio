var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a,b){if(b){var c=ba;a=a.split(".");for(var e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}
ca("Math.hypot",function(a){return a?a:function(a,c,e){a=Number(a);c=Number(c);var b,h=Math.max(Math.abs(a),Math.abs(c));for(b=2;b<arguments.length;b++)h=Math.max(h,Math.abs(arguments[b]));if(1E100<h||1E-100>h){if(!h)return h;a/=h;c/=h;var k=a*a+c*c;for(b=2;b<arguments.length;b++){var p=Number(arguments[b])/h;k+=p*p}return Math.sqrt(k)*h}k=a*a+c*c;for(b=2;b<arguments.length;b++)p=Number(arguments[b]),k+=p*p;return Math.sqrt(k)}});
function f(a,b,c,e){this.A=a;this.B=b;this.D=a+c;this.F=b+e;this.left=this.A;this.top=this.B;this.width=c;this.height=e;this.h=function(){return{x:(this.A+this.D)/2|0,y:(this.B+this.F)/2|0}};this.o=function(){var a=g[ea];return this.A<=a.D&&this.D>=a.A&&this.B<=a.F&&this.F>=a.B}};function fa(){this.c=!1;this.I=this.f=0}fa.prototype.update=function(){this.c?(this.f++,this.I=0):(this.f=0,this.I++)};for(var m=Array(256),ha=0;256>ha;ha++)m[ha]=new fa;function ia(a,b){a.stopPropagation();a.preventDefault();a=a.keyCode;0<=a&&256>a&&(m[a].c=b)}window.onload=function(){document.addEventListener("keydown",function(a){ia(a,!0)});document.addEventListener("keyup",function(a){ia(a,!1)})};var q=new fa;q.x=0;q.y=0;q.u=0;q.v=0;function ja(a){a.stopPropagation();a.preventDefault();ka(a.clientX,a.clientY);"mousedown"===a.type&&(q.c=!0,r.focus());"mouseup"===a.type&&(q.c=!1)}function la(a){a.stopPropagation();a.preventDefault();0<a.touches.length?(a=a.touches[0],ka(a.clientX,a.clientY),q.c=!0):q.c=!1}
function ka(a,b){var c=r.getBoundingClientRect(),e=c.width/c.height;if(.01<e-ma){var d=ma*c.height;c=new f(Math.floor((c.width-d)/2),0,d,c.height)}-.01>e-ma&&(e=c.width/ma,c=new f(0,Math.floor((c.height-e)/2),c.width,e));e=q.x;d=q.y;q.x=t*(a-c.left)/c.width|0;q.y=u*(b-c.top)/c.height|0;q.u=q.x-e;q.v=q.y-d}function na(a,b){return q.x>=a&&q.x<a+80&&q.y>=b&&q.y<b+8};var oa=[0,-1,1,0],pa=[-1,0,0,1],qa=[1,1,1,1];
function ra(a){for(var b=w.target,c=x,e=0;e<c.height;e++)for(var d=0;d<c.width;d++){var h=c.a[e][d];h.C=Infinity;h.aa=Math.min(Math.abs(d-b.x),Math.abs(e-b.y));h.ea=null}a=x.a[a.y][a.x];a.C=0;for(a=[a];0<a.length;){c=null;e=-1;d=Infinity;for(h=0;h<a.length;h++){var k=a[h];Infinity!==k.C&&k.C+k.aa<d&&(c=k,e=h,d=k.C+k.aa)}a.splice(e,1);if(c.x===b.x&&c.y===b.y){b=[];for(a=c;a;)b.push(a),a=a.ea;b.reverse();return b}for(e=0;e<oa.length;e++)if(d=c.x+oa[e],h=c.y+pa[e],0<=d&&d<x.width&&0<=h&&h<x.height){k=
x.a[h][d];var p=c.C+qa[e];p<k.C&&20>=p&&!x.a[h][d].m&&(k.C=p,k.ea=c,a.push(k))}}return null};function sa(a,b,c){b=ua(a,a.VERTEX_SHADER,b);c=ua(a,a.FRAGMENT_SHADER,c);var e=a.createProgram();a.attachShader(e,b);a.attachShader(e,c);a.linkProgram(e);return e}function ua(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);return b}
function va(){var a=y.createTexture();y.bindTexture(y.TEXTURE_2D,a);var b=y.RGBA,c=y.RGBA,e=y.UNSIGNED_BYTE;y.texImage2D(y.TEXTURE_2D,0,b,1,1,0,c,e,new Uint8Array([0,0,0,0]));var d=new Image;d.onload=function(){y.bindTexture(y.TEXTURE_2D,a);y.texImage2D(y.TEXTURE_2D,0,b,c,e,d);y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE);y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE);y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.NEAREST);y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,
y.NEAREST);y.generateMipmap(y.TEXTURE_2D);a.loaded=!0;a.width=d.width;a.height=d.height};d.src="img/graphics.png";return a};function wa(a,b){this.x=a;this.y=b;this.ka=0;this.m=!0;this.fa=this.visible=!1;this.aa=this.C=0;this.ea=null}function xa(){this.height=this.width=256;this.ga=null;this.H=new Uint8Array(262144);this.ua=new Float32Array([256,256]);this.clear()}xa.prototype.clear=function(){for(var a=0;a<this.H.length;a++)this.H[a]=255};
xa.prototype.ba=function(a){this.ga=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.ga);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,this.H);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)};
function ya(){this.height=this.width=256;this.a=Array(256);this.K=Array(3);this.da=new Float32Array(2);for(var a=0;256>a;a++){this.a[a]=Array(256);for(var b=0;256>b;b++)this.a[a][b]=new wa(b,a)}for(a=0;3>a;a++)this.K[a]=new xa}
ya.prototype.ba=function(a){this.oa=a;this.ma=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.ma);a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,-1,0,1,1,1,1,0,-1,1,0,0]),a.STATIC_DRAW);this.o=sa(a,"precision highp float;attribute vec2 position;attribute vec2 texture;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 viewOffset;uniform vec2 viewportSize;uniform vec2 mapSize;void main(void) {   pixelCoord = (texture * viewportSize) + viewOffset;   texCoord = pixelCoord / mapSize / 16.0;   gl_Position = vec4(position, 0.0, 1.0);}","precision highp float;varying vec2 pixelCoord;varying vec2 texCoord;uniform sampler2D tiles;uniform sampler2D sprites;void main(void) {   vec4 tile = texture2D(tiles, texCoord);   if(tile.x == 1.0 && tile.y == 1.0) { discard; }   vec2 spriteOffset = floor(tile.xy * 256.0) * 16.0;   vec2 spriteCoord = mod(pixelCoord, 16.0);   gl_FragColor = texture2D(sprites, (spriteOffset + spriteCoord) / 1024.0);   gl_FragColor.a = tile.a;}");
this.la=a.getAttribLocation(this.o,"position");this.na=a.getAttribLocation(this.o,"texture");this.ta=a.getUniformLocation(this.o,"viewportSize");this.sa=a.getUniformLocation(this.o,"viewOffset");this.pa=a.getUniformLocation(this.o,"mapSize");this.ra=a.getUniformLocation(this.o,"tiles");this.qa=a.getUniformLocation(this.o,"sprites");for(var b=0;b<this.K.length;b++)this.K[b].ba(a)};
function za(a,b,c,e){var d=x;d.a[b][a].ka=c;d.a[b][a].m=e;e=d.K[0];a=4*(b*e.width+a);e.H[a]=0===c?255:(c-1)%64|0;e.H[a+1]=0===c?255:(c-1)/64|0}function Aa(a,b,c){return 0>b||256<=b||0>c||256<=c?null:a.a[c][b]}function Ba(a){return(a=Aa(x,z,a))?a.ka:81}function A(a,b){a=Aa(x,a,b);return!a||a.m}ya.prototype.ca=function(a,b){return(a=Aa(this,a,b))&&a.visible};ya.prototype.ca=function(a,b){return a<this.W||a>this.U||b<this.X||b>this.V?!1:this.a[b][a].visible};function Ca(){var a=x,b=w.x/16|0,c=w.y/16|0;a.ia=b;a.ja=c;a.W=Math.max(0,b-12);a.X=Math.max(0,c-12);a.U=Math.min(a.width-1,b+12);a.V=Math.min(a.height-1,c+12);for(var e=a.X;e<=a.V;e++)for(var d=a.W;d<=a.U;d++)a.a[e][d].fa|=a.a[e][d].visible,a.a[e][d].visible=!1;a.a[c][b].visible=!0;Da(a,1,1);Ea(a,1,1);Da(a,1,-1);Ea(a,1,-1);Da(a,-1,1);Ea(a,-1,1);Da(a,-1,-1);Ea(a,-1,-1)}
function Da(a,b,c){var e=[],d=[],h=1,k=0,p=0,C=0,l,n;for(n=a.ja+c;n>=a.X&&n<=a.V;n+=c,p=k,++h){var W=.5/h;var D=-1;var X=Math.floor(C*h+.5);for(l=a.ia+X*b;X<=h&&l>=a.W&&l<=a.U;l+=b,++X,D=K){var T=!0;var ta=!1;var da=X/h;var K=da+W;if(0<p)if(a.a[n-c][l].visible&&!a.a[n-c][l].m||a.a[n-c][l-b].visible&&!a.a[n-c][l-b].m)for(var v=0;v<p&&T;++v){if(D<=d[v]&&K>=e[v])if(a.a[n][l].m)if(D>=e[v]&&K<=d[v]){T=!1;break}else e[v]=Math.min(e[v],D),d[v]=Math.max(d[v],K),ta=!0;else if(da>e[v]&&da<d[v]){T=!1;break}}else T=
!1;T&&(a.a[n][l].visible=!0,a.a[n][l].m&&(C>=D?C=K:ta||(e[k]=D,d[k++]=K)))}}}
function Ea(a,b,c){var e=[],d=[],h=1,k=0,p=0,C=0,l,n;for(l=a.ia+b;l>=a.W&&l<=a.U;l+=b,p=k,++h){var W=.5/h;var D=-1;var X=Math.floor(C*h+.5);for(n=a.ja+X*c;X<=h&&n>=a.X&&n<=a.V;n+=c,++X,D=K){var T=!0;var ta=!1;var da=X/h;var K=da+W;if(0<p)if(a.a[n][l-b].visible&&!a.a[n][l-b].m||a.a[n-c][l-b].visible&&!a.a[n-c][l-b].m)for(var v=0;v<p&&T;++v){if(D<=d[v]&&K>=e[v])if(a.a[n][l].m)if(D>=e[v]&&K<=d[v]){T=!1;break}else e[v]=Math.min(e[v],D),d[v]=Math.max(d[v],K),ta=!0;else if(da>e[v]&&da<d[v]){T=!1;break}}else T=
!1;T&&(a.a[n][l].visible=!0,a.a[n][l].m&&(C>=D?C=K:ta||(e[k]=D,d[k++]=K)))}}};var Fa=null,Ga=null,Ha=null,Ia=null,Ja=null,Ka=new Float32Array(2),La=null,Ma=null,Na=null,B=null,E=new Float32Array(65536),F=0,G=new Float32Array(65536),H=0,Oa=new Uint8Array(65536),Pa=new DataView(Oa.buffer),Qa=0;function I(a,b,c,e){a=a.split("\n");for(var d=0;d<a.length;d++)for(var h=0;h<a[d].length;h++){var k=a[d].charCodeAt(h);33<=k&&127>=k&&J(b+4*h,c+8*d,8*(k-33),0,8,10,e)}}
function J(a,b,c,e,d,h,k,p,C){if(B.loaded){p=a+Math.abs(void 0!==p?p:d);C=b+(void 0!==C?C:h);var l=c/B.width,n=e/B.height;c=(c+d)/B.width;e=(e+h)/B.height;k=k||0;E[F++]=a;E[F++]=b;E[F++]=p;E[F++]=b;E[F++]=a;E[F++]=C;G[H++]=l;G[H++]=n;G[H++]=c;G[H++]=n;G[H++]=l;G[H++]=e;E[F++]=a;E[F++]=C;E[F++]=p;E[F++]=b;E[F++]=p;E[F++]=C;G[H++]=l;G[H++]=e;G[H++]=c;G[H++]=n;G[H++]=c;G[H++]=e;for(a=0;6>a;a++)Pa.setUint32(Qa,k,!1),Qa+=4}};var t=256,u=144,ma=t/u,Ra=[0,0,16,17,23],Sa=[1,5,28,23,27],Ta=[2,0,1,3];var x=null,L=null,M=null,Ua=null;function Va(a){var b=a.A,c=a.D,e=a.F;for(a=a.B;a<e;a++)for(var d=b;d<c;d++)za(d,a,Wa(d,a),!1)}function Xa(a,b,c){for(var e=Math.min(a,b);e<=Math.max(a,b);e++)za(e,c,Wa(e,c),!1)}function Ya(a,b,c){for(var e=Math.min(a,b);e<=Math.max(a,b);e++)za(c,e,Wa(c,e),!1)}function Za(a,b){return Math.floor(Math.random()*(b-a)+a)}function $a(a,b){a=a/40|0;b=b/40|0;return 0>a||4<=a||0>b||4<=b?null:M[b][a]}
function Wa(a,b){a=(a=$a(a,b))?a.level:0;a=1+64*(9+a%3)+(5>a?16:20);return Za(a,a+4)}function ab(){var a=$a(z,N);a=64*(1+(a?a.level:0)%6)+17;return Za(a,a+6)};var bb=[{i:"Ok hotshot, teleportation complete.\nSystem check. Do you remember the mission?",options:[{text:"ROGER",j:"dialog",M:4},{text:"UH WHAT?",j:"dialog",M:1}]},{i:"Mother frakking... Teleportation glitch.\nYou're a lost cause. Want advice anyway?",options:[{text:"YES",j:"dialog",M:2},{text:"NO",j:"dialog",M:3}]},{i:"Alright.  Your brain is mush, but we'll try.\nFind the blaster in the room.",options:[{text:"COPY",j:"quest",S:0}]},{i:"Alright.  Your brain is mush, and you're\nballs deep in aliens who want to kill you.  Good luck.",
options:[{text:"BYE"}]},{i:"Good. How do you wanna run this, soldier?\nWant me to guide you, or comms off?",options:[{text:"GUIDE",j:"dialog",M:5},{text:"COMMS OFF",j:"dialog",M:6}]},{i:"Alright.  First things first:\nFind the blaster in the room.",options:[{text:"OK",j:"quest",S:0}]},{i:"Alright.  You know what you're doing.\nGo get em.",options:[{text:"OVER AND OUT"}]},{i:"Good.  Radar shows alien blood nearby.\nGo kill that ugly bastard.",options:[{text:"ACCEPT",j:"quest",S:1},{text:"IGNORE"}]},
{i:"Not bad, soldier.  That took guts.\nFind a BLUE key to get out of this sector.",options:[{text:"ACCEPT",j:"quest",S:2},{text:"IGNORE"}]},{i:"Excellent.  Let's get the frak out of here.\nFind the BLUE door to move to the next sector.",options:[{text:"ACCEPT",j:"quest",S:3},{text:"IGNORE"}]}],cb=!1,db=0,eb=0,fb;var gb=[{title:"Find blaster",N:"item",b:2,P:7},{title:"First blood",N:"kill",b:1,P:8},{title:"Blue keycard",N:"item",b:3,P:9},{title:"Blue door",N:"item",b:3,P:9},{title:"Pick up radio",N:"item",b:4,P:0}],O=[];function hb(a){ib("Quest accepted: "+a.title,4294902015);O.push(a)}function jb(a){ib("Quest complete: "+a.title,4294902015);void 0!==a.P&&(a=a.P,cb=!0,fb=!1,db=a,eb=kb)};var r=null,y=null,lb=0,mb=0,nb=0,kb=0,w=null,P=null,ob=null,pb=null,Q=null,R=null,S=null,qb=!1,rb=!1,sb=0,tb=0,ub=0,vb=0,wb=[],xb=0;function yb(){var a=window.innerWidth,b=window.innerHeight;var c=a>b?Math.max(1,Math.min(Math.floor(a/256),Math.floor(b/144))):Math.max(1,Math.min(Math.floor(a/144),Math.floor(b/256)));t=Math.round(a/c);u=Math.round(b/c);ma=t/u;r.width=t;r.height=u;r.style.left="0";r.style.top="0";r.style.width=a+"px";r.style.height=b+"px"}
function zb(a){return a.x+16>=R.x&&a.y+16>=R.y&&a.x<R.x+t&&a.y<R.y+u&&x.ca(a.x/16|0,a.y/16|0)}function Ab(a,b){for(var c=0;c<P.length;c++){var e=P[c];if(!(0>=e.g)&&(e.x/16|0)===a&&(e.y/16|0)===b)return e}return null}
function Bb(){for(var a=Cb.x,b=Cb.y,c=0;20>c;c++){for(var e=a-c;e<=a+c;e++){var d=b-c;if(!A(e,d)&&null===Ab(e,d))return{Z:e,$:d};d=b+c;if(!A(e,d)&&null===Ab(e,d))return{Z:e,$:d}}for(e=b-c;e<=b+c;e++){d=a-c;if(!A(d,e)&&null===Ab(d,e))return{Z:d,$:e};d=a+c;if(!A(d,e)&&null===Ab(d,e))return{Z:d,$:e}}}return null}
function Db(a,b,c,e){a.direction=e;var d=Math.hypot(b,c);e=Math.floor(a.x/16)+b/d;d=Math.floor(a.y/16)+c/d;if(A(e,d))return!1;if(e=Ab(e,d)){if(a.b===e.b)return!1;Eb(a,e,2);a.s=18;wb.push({x:e.x,y:e.y,frame:0});return!0}a.u=b;a.v=c;a.s=16/Math.max(Math.abs(b),Math.abs(c));return!0}
function Eb(a,b,c){b.g-=c;if(0>=b.g&&(b.g=0,ib(b.name+" died",4278190335),b===S&&(S=null),0===a.b)){for(w.J+=10*b.level;w.J>=w.L;)w.J-=w.L,w.L*=2,w.level++,ib("You are now level "+w.level,16711935);for(a=O.length-1;0<=a;a--)c=O[a],"kill"===c.N&&c.b===b.b&&(O.splice(a,1),jb(c))}}function ib(a,b){Q.push({text:a,color:b});5<Q.length&&Q.splice(0,Q.length-5)}
function Fb(){0===nb&&P.sort(function(a,c){return Math.hypot(a.x-w.x,a.y-w.y)-Math.hypot(c.x-w.x,c.y-w.y)});nb++;if(nb>=P.length)for(var a=nb=0;a<P.length;a++)0<P[a].g&&(P[a].l=1)}function Gb(a){if(cb){var b=bb[db];0>a||a>b.options.length||(a=b.options[a],"dialog"===a.j?(a=a.M,cb=!0,fb=!1,db=a,eb=kb):"quest"===a.j?(cb=!1,hb(gb[a.S])):cb=!1)}}
function Hb(){for(var a=0;256>a;a++)m[a].update();q.update();if(cb){if(!(30>kb-eb)){a=(t-160)/2|0;var b=(u-160)/2|0;1===m[32].I?fb=!0:1===m[49].I||1===q.I&&na(a,b+64)?Gb(0):(1===m[50].I||1===q.I&&na(a,b+80))&&Gb(1)}}else if(qb)1===m[78].f&&(qb=!1);else if(0<w.g)for(;;){a=P[nb];if(0<a.l&&0===a.s)if(0===nb)a:if(0>=w.g)w.l=0;else{var c=w.x/16|0;b=w.y/16|0;var e=!1;if(0!==q.u||0!==q.v)sb=q.x,tb=q.y,ub=(R.x+sb)/16|0,vb=(R.y+tb)/16|0;if(rb){1===m[98].f||1===m[40].f?(tb+=16,vb++):1===m[100].f||1===m[37].f?
(sb-=16,ub--):1===m[102].f||1===m[39].f?(sb+=16,ub++):1===m[104].f||1===m[38].f?(tb-=16,vb--):1===m[27].f?(w.target=null,w.path=null,rb=!1):1===m[13].f&&(rb=!1);var d=Aa(x,ub,vb);d!==w.target&&(b={x:c,y:b},w.target=d,w.path=ra(b),w.O=0)}else{if(q.c)if(q.y>u-24)0<=q.x&&32>q.x&&(e=!0);else{d=ub;var h=vb;if(S=Ab(d,h)){w.target=null;w.path=null;break a}d=Aa(x,d,h);d!==w.target&&(b={x:c,y:b},w.target=d,w.path=ra(b),w.O=0);break a}if(1===m[9].f){b=S?P.indexOf(S):0;for(c=b+1;0===c||c>=P.length||0>=P[c].g||
!zb(P[c]);)if(c++,c>=P.length&&(c=0),c===b){c=-1;break}0<c?S=P[c]:S=null}else if(1===m[13].f)sb=w.x-R.x,tb=w.y-R.y,ub=w.x/16|0,vb=w.y/16|0,rb=!0;else if(1===m[78].f)qb=!0;else{d=null;if(w.path){for(d=w.path[w.O];d&&d.x===c&&d.y===b;)w.O++,d=w.O<w.path.length?w.path[w.O]:null;d||(w.target=null,w.path=null)}h=m[100].c||m[37].c||d&&d.x<c;c=m[102].c||m[39].c||d&&d.x>c;var k=m[104].c||m[38].c||d&&d.y<b,p=m[101].c;e=1===m[49].f||e;m[98].c||m[40].c||d&&d.y>b?Db(w,0,w.w,2):h?Db(w,-w.w,0,3):p?w.l=0:c?Db(w,
w.w,0,1):k?Db(w,0,-w.w,0):e&&S&&0<w.T&&(wb.push({x:S.x,y:S.y,frame:0}),w.s=36,Eb(w,S,5),w.T--)}}}else 0>=a.g?a.l=0:zb(a)?w.x<a.x&&Db(a,-a.w,0,3)||w.x>a.x&&Db(a,a.w,0,1)||w.y<a.y&&Db(a,0,-a.w,0)||w.y>a.y&&Db(a,0,a.w,2)||0!==a.u||0!==a.v||(a.l=0):a.l=0;if(0<a.s){if(0!==a.u||0!==a.v)a.x+=a.u,a.y+=a.v;a.s--;if(0===a.s&&(a.u=0,a.v=0,a.l--,0===a.b)){for(b=ob.length-1;0<=b;b--)if(c=ob[b],c.x===a.x&&c.y===a.y)for(ob.splice(b,1),pb.push(c),ib("Picked up: "+c.name,16777215),d=O.length-1;0<=d;d--)h=O[d],"item"===
h.N&&h.b===c.b&&(O.splice(d,1),jb(h));Ca()}}0>=a.l&&(a.l=0,Fb());if(0===nb&&0<a.l)break;if(0<a.s)break}m[65].c&&(xb=10);mb++;16<mb&&(mb=0,lb++);y.viewport(0,0,t,u);y.clearColor(0,0,0,1);y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT);if(B&&B.loaded){R.x=Math.max(0,w.x-(t/2|0)+8);R.y=Math.max(0,w.y-(u/2|0)+8);0<xb--&&(R.x+=4*Math.random()-2,R.y+=4*Math.random()-2);Qa=H=F=0;if(cb){if(cb&&(a=(t-160)/2|0,b=(u-160)/2|0,J(a+64,b,128,608,32,32),c=bb[db],d=kb-eb,d=fb?c.i.length:Math.min(c.i.length,Math.floor(d/
2)),I(c.i.substr(0,d),a,b+32),d===c.i.length))for(d=0;d<c.options.length;d++)I(c.options[d].text,a,b+64+16*d)}else{a=x;b=R.x;c=R.y;k=t;p=u;if(B.loaded){d=a.oa;d.enable(d.BLEND);d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);d.useProgram(a.o);d.bindBuffer(d.ARRAY_BUFFER,a.ma);d.enableVertexAttribArray(a.la);d.enableVertexAttribArray(a.na);d.vertexAttribPointer(a.la,2,d.FLOAT,!1,16,0);d.vertexAttribPointer(a.na,2,d.FLOAT,!1,16,8);a.da[0]=k;a.da[1]=p;d.uniform2fv(a.ta,a.da);d.activeTexture(d.TEXTURE0);
d.uniform1i(a.qa,0);d.activeTexture(d.TEXTURE1);d.uniform1i(a.ra,1);h=b/16|0;e=c/16|0;k=(b+k)/16|0;p=(c+p)/16|0;for(var C=0;C<a.K.length;C++){for(var l=a.K[C],n=e;n<=p;n++)for(var W=h;W<=k;W++){var D=a.ca(W,n)?255:(D=Aa(a,W,n))&&D.fa?144:0;l.H[4*(n*l.width+W)+3]=D}d.uniform2f(a.sa,b,c);d.uniform2fv(a.pa,l.ua);d.bindTexture(d.TEXTURE_2D,l.ga);d.texSubImage2D(d.TEXTURE_2D,0,0,0,l.width,l.height,d.RGBA,d.UNSIGNED_BYTE,l.H);d.drawArrays(d.TRIANGLES,0,6)}}w.target&&(a=16*w.target.x-R.x,b=16*w.target.y-
R.y,c=640,A(w.target.x,w.target.y)&&(c=688),J(a,b,c,176,16,16));for(a=0;a<ob.length;a++)b=ob[a],zb(b)&&J(b.x-R.x,b.y-R.y,16*Ra[b.b],16*Sa[b.b],16,16);for(a=0;a<P.length;a++)b=P[a],zb(b)&&(c=b.x-R.x,d=b.y-R.y,0>=b.g?(h=496,e=432):(h=16*(Ra[b.b]+Ta[b.direction]),e=16*(Sa[b.b]+lb%2)),b===S&&J(c,d,720,176,16,16),J(c,d,h,e,16,16));for(a=wb.length-1;0<=a;a--)b=wb[a],J(b.x-R.x,b.y-R.y,128+16*Math.floor(b.frame/6),304,16,16),b.frame++,18<=b.frame&&wb.splice(a,1);for(b=a=0;b<P.length;b++)c=P[b],c!==w&&0>=
c.g||!zb(c)||(c===w?(d=c.g/c.R,I(c.name,0,a),J(0,a+7,544,208,32,12),J(2,a+9,544,224,8,8,void 0,Math.round(28*d)),I(c.g+"/"+c.R,0,a+10),d=w.T/w.ha,I("AMMO",32,a),J(32,a+7,544,208,32,12),J(34,a+9,552,224,8,8,void 0,Math.round(28*d)),I(c.T+"/"+c.ha,32,a+10),d=w.J/w.L,I("LEVEL "+w.level,64,a),J(64,a+7,544,208,32,12),J(66,a+9,568,224,8,8,void 0,Math.round(28*d)),I(c.J+"/"+c.L,64,a+10)):(d=c.g/c.R,I(c.name,0,a),J(0,a+7,544,208,32,12),J(2,a+9,560,224,8,8,void 0,Math.round(28*d)),I(c.g+"/"+c.R,0,a+10)),a+=
24);if(0<O.length)for(I("OBJECTIVES:",t-60,0),a=0;a<O.length;a++)I(O[a].title,t-60,8+8*a);a=u-24-8*Q.length;for(b=0;b<Q.length;b++)I(Q[b].text,0,a+8*b,Q[b].color);for(a=0;6>a;a++)J(24*a,u-24,512,208,24,24),0===a&&J(24*a+4,u-24+4,256,448,16,16);qb&&(J(0,0,512,256,144,144,128,t,u),a=(t-144)/2|0,b=(u-144)/2|0,J(a,b,512,256,144,144),J(a+10,b+9,480,416,16,16),I("2",a+21,b+19,16711935),J(a+22,b+33,464,416,16,16),I("0",a+33,b+43,16711935),J(a+22,b+57,624,160,16,16),I("0",a+33,b+67,16711935),J(a+22,b+81,
448,416,16,16),I("0",a+33,b+91,16711935),J(a+56,b+9,336,416,16,16),I("0",a+67,b+19,16711935),J(a+68,b+33,336,448,16,16),I("0",a+79,b+43,16711935),J(a+68,b+57,272,400,16,16),I("0",a+79,b+67,16711935),J(a+68,b+81,400,432,16,16),I("0",a+79,b+91,16711935),J(a+102,b+9,128,354,16,16),I("0",a+113,b+19,16711935),J(a+114,b+33,592,160,16,16),I("0",a+125,b+43,16711935),J(a+114,b+57,272,400,16,16),I("0",a+125,b+67,16711935),J(a+114,b+81,352,400,16,16),I("0",a+125,b+91,16711935),I("1: Leap 2 squares",a+8,b+106,
4294967295),I("2: Leap 3 squares",a+8,b+114,4294967295),I("3: Leap 4 squares",a+8,b+122,16711935),I("4: Leap 5 squares",a+8,b+130,2155905279))}B.loaded&&(y.useProgram(Fa),Ka[0]=t,Ka[1]=u,y.uniform2fv(Ga,Ka),y.activeTexture(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,B),y.enableVertexAttribArray(Ha),y.bindBuffer(y.ARRAY_BUFFER,La),y.bufferData(y.ARRAY_BUFFER,E,y.DYNAMIC_DRAW),y.vertexAttribPointer(Ha,2,y.FLOAT,!1,0,0),y.enableVertexAttribArray(Ia),y.bindBuffer(y.ARRAY_BUFFER,Ma),y.bufferData(y.ARRAY_BUFFER,
G,y.DYNAMIC_DRAW),y.vertexAttribPointer(Ia,2,y.FLOAT,!1,0,0),y.enableVertexAttribArray(Ja),y.bindBuffer(y.ARRAY_BUFFER,Na),y.bufferData(y.ARRAY_BUFFER,Oa,y.DYNAMIC_DRAW),y.vertexAttribPointer(Ja,4,y.UNSIGNED_BYTE,!0,0,0),y.drawArrays(y.TRIANGLES,0,F/2));kb++}requestAnimationFrame(Hb)}r=document.querySelectorAll("canvas")[0];
if(y=r.getContext("webgl",{alpha:!1,antialias:!1})){y.disable(y.DEPTH_TEST);y.enable(y.BLEND);y.blendFunc(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA);Fa=sa(y,"uniform vec2 u_viewportSize;attribute vec2 a_position;attribute vec2 a_texCoord;attribute vec4 a_color;varying vec2 v_texCoord;varying vec4 v_color;void main() {vec2 zeroToOne = a_position / u_viewportSize;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;v_color = a_color;}","precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;varying vec4 v_color;void main() {gl_FragColor = texture2D(u_image, v_texCoord);if (gl_FragColor.a < 0.1) discard;if (v_color.a > 0.5) gl_FragColor = v_color;}");
La=y.createBuffer();Ma=y.createBuffer();Na=y.createBuffer();Ga=y.getUniformLocation(Fa,"u_viewportSize");Ha=y.getAttribLocation(Fa,"a_position");Ia=y.getAttribLocation(Fa,"a_texCoord");Ja=y.getAttribLocation(Fa,"a_color");B=va();B=va();x=new ya;L=[];M=[];Ua=[];for(var Ib=0;4>Ib;Ib++){M.push(Array(4));for(var Jb=0;4>Jb;Jb++)M[Ib][Jb]=null}for(var Kb=0;10>Kb;Kb++){var U={level:Kb,x:0,y:0,parent:null,G:0,children:[],Y:[]};if(0===Kb)U.x=Math.floor(4*Math.random()),U.y=Math.floor(4*Math.random());else{var V=
Ua[Math.floor(Math.random()*Ua.length)];V.children.push(U);V.G--;U.parent=V;0<V.x&&!M[V.y][V.x-1]&&(U.x=V.x-1,U.y=V.y);0<V.y&&!M[V.y-1][V.x]&&(U.x=V.x,U.y=V.y-1);3>V.x&&!M[V.y][V.x+1]&&(U.x=V.x+1,U.y=V.y);3>V.y&&!M[V.y+1][V.x]&&(U.x=V.x,U.y=V.y+1)}U.rect=new f(40*U.x,40*U.y,40,40);L.push(U);M[U.y][U.x]=U;Ua=[];for(var Lb=0;Lb<L.length;Lb++){var Y=L[Lb];Y.G=0;0<Y.x&&!M[Y.y][Y.x-1]&&Y.G++;0<Y.y&&!M[Y.y-1][Y.x]&&Y.G++;3>Y.x&&!M[Y.y][Y.x+1]&&Y.G++;3>Y.y&&!M[Y.y+1][Y.x]&&Y.G++;0<Y.G&&Ua.push(Y)}}for(var Mb=
0;Mb<L.length;Mb++){var Z=L[Mb],g=Z.Y,Nb=new f(Z.rect.A+1,Z.rect.h().y-2,5,5);Va(Nb);g.push(Nb);var Ob=new f(Z.rect.D-5,Z.rect.h().y-2,5,5);Va(Ob);g.push(Ob);var Pb=new f(Z.rect.h().x-2,Z.rect.B+1,5,5);Va(Pb);g.push(Pb);var Qb=new f(Z.rect.h().x-2,Z.rect.F-5,5,5);Va(Qb);for(g.push(Qb);10>g.length;){for(var Rb=new f(Za(Z.rect.A+2,Z.rect.D-12-3),Za(Z.rect.B+2,Z.rect.F-8-3),Za(5,12),Za(5,8)),Sb=!1,ea=0;ea<g.length;ea++)if(Rb.o()){Sb=!0;break}Sb||(Va(Rb),g.push(Rb))}var Tb=void 0,Ub=void 0,Vb=void 0,
Wb=g;for(Tb=Wb.length-1;0<Tb;Tb--)Vb=Math.floor(Math.random()*(Tb+1)),Ub=Wb[Tb],Wb[Tb]=Wb[Vb],Wb[Vb]=Ub;for(var Xb=1;Xb<g.length;Xb++){var Yb=g[Xb].h(),Zb=g[Xb-1].h();.5>Math.random()?(Xa(Zb.x,Yb.x,Zb.y),Ya(Zb.y,Yb.y,Yb.x)):(Ya(Zb.y,Yb.y,Zb.x),Xa(Zb.x,Yb.x,Yb.y))}Z.parent&&(Z.parent.x<Z.x?Xa(Z.rect.A-3,Z.rect.A+3,Z.rect.h().y):Z.parent.x>Z.x?Xa(Z.rect.D-3,Z.rect.D+3,Z.rect.h().y):Z.parent.y<Z.y?Ya(Z.rect.B-3,Z.rect.B+3,Z.rect.h().x):Z.parent.y>Z.y&&Ya(Z.rect.F-3,Z.rect.F+3,Z.rect.h().x))}for(var N=
0;256>N;N++)for(var z=0;256>z;z++)if(A(z,N))if(A(z,N+1))if(0!==Ba(N)&&0===Ba(N+1))za(z,N,ab(),!0);else{if(!(A(z,N-1)&&A(z-1,N)&&A(z+1,N)&&A(z-1,N-1)&&A(z+1,N-1)&&A(z-1,N+1)&&A(z+1,N+1))){var $b=$a(z,N),ac=64*(1+($b?$b.level:0)%6)+23;za(z,N,Za(ac,ac+6),!0)}}else za(z,N,ab(),!0);w={b:0,name:"Player",x:16*L[0].Y[0].h().x,y:16*L[0].Y[0].h().y,u:0,v:0,direction:2,g:100,R:100,l:1,s:0,w:2,target:null,path:null,O:0,T:100,ha:100,J:0,L:10,level:1};var bc={b:4,name:"Radio",x:w.x+32,y:w.y-32},cc={b:2,name:"Blaster",
x:w.x+32,y:w.y+32};P=[w];ob=[bc,cc];pb=[];Q=[];R={x:0,y:0};S=null;for(var dc=0;dc<L.length;dc++)for(var ec=L[dc],fc=ec.Y,gc=1;gc<fc.length;gc++){for(var Cb=fc[gc].h(),hc=ec.level/3|1,ic=0;ic<hc;ic++){var jc=Bb();if(!jc)break;P.push({b:1,level:ec.level+1,name:"Alien ("+(ec.level+1)+")",x:16*jc.Z,y:16*jc.$,u:0,v:0,direction:2,g:10+5*ec.level,R:10+5*ec.level,l:1,s:0,w:4})}8===gc&&ob.push({b:3,name:"Blue Key",x:16*Cb.x+32,y:16*Cb.y+32})}Ca();hb(gb[4]);x.ba(y);window.addEventListener("resize",yb,!1);yb();
var kc=r;kc.addEventListener("mousedown",ja);kc.addEventListener("mouseup",ja);kc.addEventListener("mousemove",ja);kc.addEventListener("contextmenu",ja);kc.addEventListener("touchstart",la);kc.addEventListener("touchend",la);kc.addEventListener("touchcancel",la);kc.addEventListener("touchmove",la);requestAnimationFrame(Hb)};
