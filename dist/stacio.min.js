var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a,b){if(b){var d=ba;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];e in d||(d[e]={});d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&null!=b&&aa(d,a,{configurable:!0,writable:!0,value:b})}}
ca("Math.hypot",function(a){return a?a:function(a,d,c){a=Number(a);d=Number(d);var b,f=Math.max(Math.abs(a),Math.abs(d));for(b=2;b<arguments.length;b++)f=Math.max(f,Math.abs(arguments[b]));if(1E100<f||1E-100>f){if(!f)return f;a/=f;d/=f;var h=a*a+d*d;for(b=2;b<arguments.length;b++){var k=Number(arguments[b])/f;h+=k*k}return Math.sqrt(h)*f}h=a*a+d*d;for(b=2;b<arguments.length;b++)k=Number(arguments[b]),h+=k*k;return Math.sqrt(h)}});function g(a,b,d,c){this.H=a;this.I=b;this.K=a+d;this.L=b+c;this.left=this.H;this.top=this.I;this.width=d;this.height=c;this.o=function(){return{x:(this.H+this.K)/2|0,y:(this.I+this.L)/2|0}};this.a=function(a){return this.H<=a.K&&this.K>=a.H&&this.I<=a.L&&this.L>=a.I}};function da(){this.j=!1;this.C=this.h=0}da.prototype.update=function(){this.j?(this.h++,this.C=0):(this.h=0,this.C++)};function ea(a){this.keys=Array(256);for(var b=0;256>b;b++)this.keys[b]=new da;a.tabIndex=0;var d=this;a.addEventListener("keydown",function(a){fa(d,a,!0)});a.addEventListener("keyup",function(a){fa(d,a,!1)})}ea.prototype.update=function(){for(var a=0;256>a;a++)this.keys[a].update()};function fa(a,b,d){b.stopPropagation();b.preventDefault();b=b.keyCode;0<=b&&256>b&&(a.keys[b].j=d)};function ha(a){this.a=a;this.F=this.D=this.f=this.b=this.y=this.x=0;this.j=!1;this.C=this.h=0;a=a.a;var b=this.g.bind(this);a.addEventListener("mousedown",b);a.addEventListener("mouseup",b);a.addEventListener("mousemove",b);a.addEventListener("contextmenu",b);b=this.N.bind(this);a.addEventListener("touchstart",b);a.addEventListener("touchend",b);a.addEventListener("touchcancel",b);a.addEventListener("touchmove",b)}
ha.prototype.update=function(){this.D=this.x-this.b;this.F=this.y-this.f;this.b=this.x;this.f=this.y;this.j?(this.h++,this.C=0):(this.h=0,this.C++)};ha.prototype.g=function(a){a.stopPropagation();a.preventDefault();ia(this,a.clientX,a.clientY);"mousedown"===a.type&&(this.j=!0,this.a.a.focus());"mouseup"===a.type&&(this.j=!1)};ha.prototype.N=function(a){a.stopPropagation();a.preventDefault();0<a.touches.length?(a=a.touches[0],ia(this,a.clientX,a.clientY),this.j=!0):this.j=!1};
function ia(a,b,d){var c=a.a.a.getBoundingClientRect(),e=c.width/c.height;if(.01<e-a.a.aspectRatio){var f=a.a.aspectRatio*c.height;c=new g(Math.floor((c.width-f)/2),0,f,c.height)}-.01>e-a.a.aspectRatio&&(e=c.width/a.a.aspectRatio,c=new g(0,Math.floor((c.height-e)/2),c.width,e));a.x=a.a.width*(b-c.left)/c.width|0;a.y=a.a.height*(d-c.top)/c.height|0}function ja(a,b){return n.x>=a&&n.x<a+80&&n.y>=b&&n.y<b+8};var ka=[0,-1,1,0],la=[-1,0,0,1],ma=[1,1,1,1];function na(a,b,d){b=oa(a,a.VERTEX_SHADER,b);d=oa(a,a.FRAGMENT_SHADER,d);var c=a.createProgram();a.attachShader(c,b);a.attachShader(c,d);a.linkProgram(c);return c}function oa(a,b,d){b=a.createShader(b);a.shaderSource(b,d);a.compileShader(b);return b}
function pa(a){var b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);var d=a.RGBA,c=a.RGBA,e=a.UNSIGNED_BYTE;a.texImage2D(a.TEXTURE_2D,0,d,1,1,0,c,e,new Uint8Array([0,0,0,0]));var f=new Image;f.onload=function(){a.bindTexture(a.TEXTURE_2D,b);a.texImage2D(a.TEXTURE_2D,0,d,c,e,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,
a.NEAREST);a.generateMipmap(a.TEXTURE_2D);b.loaded=!0;b.width=f.width;b.height=f.height};f.src="img/graphics.png";return b};function qa(a,b){this.x=a;this.y=b;this.sa=0;this.w=!0;this.pa=this.visible=!1;this.ma=this.J=0;this.oa=null}function ra(){this.height=this.width=256;this.qa=null;this.O=new Uint8Array(262144);this.va=new Float32Array([256,256]);this.clear()}ra.prototype.clear=function(){for(var a=0;a<this.O.length;a++)this.O[a]=255};
ra.prototype.na=function(a){this.qa=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.qa);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,this.O);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)};
function sa(){this.height=this.width=256;this.c=Array(256);this.b=Array(3);this.U=new Float32Array(2);for(var a=0;256>a;a++){this.c[a]=Array(256);for(var b=0;256>b;b++)this.c[a][b]=new qa(b,a)}for(a=0;3>a;a++)this.b[a]=new ra}
sa.prototype.na=function(a){this.N=a;this.ia=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.ia);a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,-1,0,1,1,1,1,0,-1,1,0,0]),a.STATIC_DRAW);this.a=na(a,"precision highp float;attribute vec2 position;attribute vec2 texture;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 viewOffset;uniform vec2 viewportSize;uniform vec2 mapSize;void main(void) {   pixelCoord = (texture * viewportSize) + viewOffset;   texCoord = pixelCoord / mapSize / 16.0;   gl_Position = vec4(position, 0.0, 1.0);}","precision highp float;varying vec2 pixelCoord;varying vec2 texCoord;uniform sampler2D tiles;uniform sampler2D sprites;void main(void) {   vec4 tile = texture2D(tiles, texCoord);   if(tile.x == 1.0 && tile.y == 1.0) { discard; }   vec2 spriteOffset = floor(tile.xy * 256.0) * 16.0;   vec2 spriteCoord = mod(pixelCoord, 16.0);   gl_FragColor = texture2D(sprites, (spriteOffset + spriteCoord) / 1024.0);   gl_FragColor.a = tile.a;}");
this.ha=a.getAttribLocation(this.a,"position");this.ca=a.getAttribLocation(this.a,"texture");this.ua=a.getUniformLocation(this.a,"viewportSize");this.ta=a.getUniformLocation(this.a,"viewOffset");this.ja=a.getUniformLocation(this.a,"mapSize");this.la=a.getUniformLocation(this.a,"tiles");this.ka=a.getUniformLocation(this.a,"sprites");for(var b=0;b<this.b.length;b++)this.b[b].na(a)};
function p(a,b,d,c){var e=q;e.c[b][a].sa=d;e.c[b][a].w=c;c=e.b[0];a=4*(b*c.width+a);c.O[a]=0===d?255:(d-1)%64|0;c.O[a+1]=0===d?255:(d-1)/64|0}function t(a,b,d){return 0>b||b>=a.width||0>d||d>=a.height?null:a.c[d][b]}function ta(a,b){return(a=t(q,a,b))?a.sa:81}function u(a,b){a=t(q,a,b);return!a||a.w}sa.prototype.R=function(a,b){return(a=t(this,a,b))&&a.visible};sa.prototype.R=function(a,b){return a<this.v||a>this.f||b<this.A||b>this.g?!1:this.c[b][a].visible};function ua(){var a=q,b=x.x/16|0,d=x.y/16|0;a.$=b;a.ba=d;a.v=Math.max(0,b-12);a.A=Math.max(0,d-12);a.f=Math.min(a.width-1,b+12);a.g=Math.min(a.height-1,d+12);for(var c=a.A;c<=a.g;c++)for(var e=a.v;e<=a.f;e++)a.c[c][e].pa|=a.c[c][e].visible,a.c[c][e].visible=!1;a.c[d][b].visible=!0;va(a,1,1);wa(a,1,1);va(a,1,-1);wa(a,1,-1);va(a,-1,1);wa(a,-1,1);va(a,-1,-1);wa(a,-1,-1)}
function va(a,b,d){var c=[],e=[],f=1,h=0,k=0,r=0,l,m;for(m=a.ba+d;m>=a.A&&m<=a.g;m+=d,k=h,++f){var C=.5/f;var w=-1;var I=Math.floor(r*f+.5);for(l=a.$+I*b;I<=f&&l>=a.v&&l<=a.f;l+=b,++I,w=D){var F=!0;var W=!1;var N=I/f;var D=N+C;if(0<k)if(a.c[m-d][l].visible&&!a.c[m-d][l].w||a.c[m-d][l-b].visible&&!a.c[m-d][l-b].w)for(var v=0;v<k&&F;++v){if(w<=e[v]&&D>=c[v])if(a.c[m][l].w)if(w>=c[v]&&D<=e[v]){F=!1;break}else c[v]=Math.min(c[v],w),e[v]=Math.max(e[v],D),W=!0;else if(N>c[v]&&N<e[v]){F=!1;break}}else F=
!1;F&&(a.c[m][l].visible=!0,a.c[m][l].w&&(r>=w?r=D:W||(c[h]=w,e[h++]=D)))}}}
function wa(a,b,d){var c=[],e=[],f=1,h=0,k=0,r=0,l,m;for(l=a.$+b;l>=a.v&&l<=a.f;l+=b,k=h,++f){var C=.5/f;var w=-1;var I=Math.floor(r*f+.5);for(m=a.ba+I*d;I<=f&&m>=a.A&&m<=a.g;m+=d,++I,w=D){var F=!0;var W=!1;var N=I/f;var D=N+C;if(0<k)if(a.c[m][l-b].visible&&!a.c[m][l-b].w||a.c[m-d][l-b].visible&&!a.c[m-d][l-b].w)for(var v=0;v<k&&F;++v){if(w<=e[v]&&D>=c[v])if(a.c[m][l].w)if(w>=c[v]&&D<=e[v]){F=!1;break}else c[v]=Math.min(c[v],w),e[v]=Math.max(e[v],D),W=!0;else if(N>c[v]&&N<e[v]){F=!1;break}}else F=
!1;F&&(a.c[m][l].visible=!0,a.c[m][l].w&&(r>=w?r=D:W||(c[h]=w,e[h++]=D)))}}};function xa(a){this.N=a;var b=na(a,"uniform vec2 u_viewportSize;attribute vec2 a_position;attribute vec2 a_texCoord;attribute vec4 a_color;varying vec2 v_texCoord;varying vec4 v_color;void main() {vec2 zeroToOne = a_position / u_viewportSize;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;v_color = a_color;}","precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;varying vec4 v_color;void main() {gl_FragColor = texture2D(u_image, v_texCoord);if (gl_FragColor.a < 0.1) discard;if (v_color.a > 0.5) gl_FragColor = v_color;}");
this.ja=b;this.la=a.getUniformLocation(b,"u_viewportSize");this.$=a.getAttribLocation(b,"a_position");this.ba=a.getAttribLocation(b,"a_texCoord");this.R=a.getAttribLocation(b,"a_color");this.A=new Float32Array(2);this.ca=a.createBuffer();this.ka=a.createBuffer();this.ha=a.createBuffer();this.aa=pa(a);this.b=new Float32Array(65536);this.a=0;this.f=new Float32Array(65536);this.g=0;this.U=new Uint8Array(65536);this.ia=new DataView(this.U.buffer);this.v=0}
function ya(a,b,d,c,e,f,h,k,r,l){var m=a.aa;if(m.loaded){r=b+Math.abs(void 0!==r?r:f);l=d+(void 0!==l?l:h);var C=c/m.width,w=e/m.height;c=(c+f)/m.width;e=(e+h)/m.height;k=k||0;a.b[a.a++]=b;a.b[a.a++]=d;a.b[a.a++]=r;a.b[a.a++]=d;a.b[a.a++]=b;a.b[a.a++]=l;a.f[a.g++]=C;a.f[a.g++]=w;a.f[a.g++]=c;a.f[a.g++]=w;a.f[a.g++]=C;a.f[a.g++]=e;a.b[a.a++]=b;a.b[a.a++]=l;a.b[a.a++]=r;a.b[a.a++]=d;a.b[a.a++]=r;a.b[a.a++]=l;a.f[a.g++]=C;a.f[a.g++]=e;a.f[a.g++]=c;a.f[a.g++]=w;a.f[a.g++]=c;a.f[a.g++]=e;for(b=0;6>b;b++)a.ia.setUint32(a.v,
k,!1),a.v+=4}};function za(){var a=document.querySelector("canvas"),b=a.getContext("webgl",{alpha:!1,antialias:!1});if(b){this.a=a;this.options={};this.N=b;this.aspectRatio=this.height=this.width=1;b.disable(b.DEPTH_TEST);b.enable(b.BLEND);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);this.b=new xa(b);this.g=new ea(a);this.keys=this.g.keys;this.v=new ha(this);q=new sa;y=[];z=[];A=[];for(a=0;4>a;a++){z.push(Array(4));for(var d=0;4>d;d++)z[a][d]=null}for(a=0;10>a;a++){d={level:a,x:0,y:0,parent:null,M:0,children:[],
ea:[]};if(0===a)d.x=Math.floor(4*Math.random()),d.y=Math.floor(4*Math.random());else{var c=A[Math.floor(Math.random()*A.length)];c.children.push(d);c.M--;d.parent=c;0<c.x&&!z[c.y][c.x-1]&&(d.x=c.x-1,d.y=c.y);0<c.y&&!z[c.y-1][c.x]&&(d.x=c.x,d.y=c.y-1);3>c.x&&!z[c.y][c.x+1]&&(d.x=c.x+1,d.y=c.y);3>c.y&&!z[c.y+1][c.x]&&(d.x=c.x,d.y=c.y+1)}d.rect=new g(40*d.x,40*d.y,40,40);y.push(d);z[d.y][d.x]=d;A=[];for(d=0;d<y.length;d++)c=y[d],c.M=0,0<c.x&&!z[c.y][c.x-1]&&c.M++,0<c.y&&!z[c.y-1][c.x]&&c.M++,3>c.x&&
!z[c.y][c.x+1]&&c.M++,3>c.y&&!z[c.y+1][c.x]&&c.M++,0<c.M&&A.push(c)}for(a=0;a<y.length;a++){d=y[a];c=d.ea;var e=new g(d.rect.H+1,d.rect.o().y-2,5,5);B(e);c.push(e);e=new g(d.rect.K-5,d.rect.o().y-2,5,5);B(e);c.push(e);e=new g(d.rect.o().x-2,d.rect.I+1,5,5);B(e);c.push(e);e=new g(d.rect.o().x-2,d.rect.L-5,5,5);B(e);for(c.push(e);10>c.length;){e=new g(E(d.rect.H+2,d.rect.K-12-3),E(d.rect.I+2,d.rect.L-8-3),E(5,12),E(5,8));for(var f=!1,h=0;h<c.length;h++)if(e.a(c[h])){f=!0;break}f||(B(e),c.push(e))}for(e=
c.length-1;0<e;e--)h=Math.floor(Math.random()*(e+1)),f=c[e],c[e]=c[h],c[h]=f;for(e=1;e<c.length;e++)f=c[e].o(),h=c[e-1].o(),.5>Math.random()?(Aa(h.x,f.x,h.y),Ba(h.y,f.y,f.x)):(Ba(h.y,f.y,h.x),Aa(h.x,f.x,f.y));d.parent&&(d.parent.x<d.x?Aa(d.rect.H-3,d.rect.H+3,d.rect.o().y):d.parent.x>d.x?Aa(d.rect.K-3,d.rect.K+3,d.rect.o().y):d.parent.y<d.y?Ba(d.rect.I-3,d.rect.I+3,d.rect.o().x):d.parent.y>d.y&&Ba(d.rect.L-3,d.rect.L+3,d.rect.o().x))}for(a=0;256>a;a++)for(d=0;256>d;d++)u(d,a)&&(u(d,a+1)?0!==ta(d,
a)&&0===ta(d,a+1)?p(d,a,Ca(d,a),!0):u(d,a-1)&&u(d-1,a)&&u(d+1,a)&&u(d-1,a-1)&&u(d+1,a-1)&&u(d-1,a+1)&&u(d+1,a+1)||(c=Da(d,a),c=64*(1+(c?c.level:0)%6)+23,p(d,a,E(c,c+6),!0)):p(d,a,Ca(d,a),!0));x={i:0,name:"Player",x:16*y[0].ea[0].o().x,y:16*y[0].ea[0].o().y,D:0,F:0,direction:2,l:100,X:100,m:1,B:0,G:2,target:null,path:null,Y:0,da:100,ra:100,P:0,S:10,level:1};a={i:4,name:"Radio",x:x.x+32,y:x.y-32};d={i:2,name:"Blaster",x:x.x+32,y:x.y+32};G=[x];H=[a,d];Ea=[];J=[];K={x:0,y:0};L=null;for(a=0;a<y.length;a++)for(d=
y[a],c=d.ea,e=1;e<c.length;e++){f=c[e].o();h=d.level/3|1;for(var k=0;k<h;k++){var r=Fa(f.x,f.y);if(!r)break;G.push({i:1,level:d.level+1,name:"Alien ("+(d.level+1)+")",x:16*r.fa,y:16*r.ga,D:0,F:0,direction:2,l:10+5*d.level,X:10+5*d.level,m:1,B:0,G:4})}8===e&&H.push({i:3,name:"Blue Key",x:16*f.x+32,y:16*f.y+32})}ua();Ga(Ha[4]);q.na(b);window.addEventListener("resize",this.f.bind(this),!1);this.f();this.A()}}
za.prototype.f=function(){var a=window.innerWidth,b=window.innerHeight;var d=a>b?Math.max(1,Math.min(Math.floor(a/256),Math.floor(b/144))):Math.max(1,Math.min(Math.floor(a/144),Math.floor(b/256)));this.width=Math.round(a/d);this.height=Math.round(b/d);this.aspectRatio=this.width/this.height;this.a.width=this.width;this.a.height=this.height;this.a.style.left="0";this.a.style.top="0";this.a.style.width=a+"px";this.a.style.height=b+"px"};
za.prototype.A=function(){this.g.update();this.v.update();var a=this.N;a.viewport(0,0,this.width,this.height);a.clearColor(0,0,0,1);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);this.b.a=0;this.b.g=0;this.b.v=0;this.update&&this.update();a=this.b;var b=this.width,d=this.height;if(a.aa.loaded){var c=a.N;c.useProgram(a.ja);a.A[0]=b;a.A[1]=d;c.uniform2fv(a.la,a.A);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,a.aa);c.enableVertexAttribArray(a.$);c.bindBuffer(c.ARRAY_BUFFER,a.ca);c.bufferData(c.ARRAY_BUFFER,
a.b,c.DYNAMIC_DRAW);c.vertexAttribPointer(a.$,2,c.FLOAT,!1,0,0);c.enableVertexAttribArray(a.ba);c.bindBuffer(c.ARRAY_BUFFER,a.ka);c.bufferData(c.ARRAY_BUFFER,a.f,c.DYNAMIC_DRAW);c.vertexAttribPointer(a.ba,2,c.FLOAT,!1,0,0);c.enableVertexAttribArray(a.R);c.bindBuffer(c.ARRAY_BUFFER,a.ha);c.bufferData(c.ARRAY_BUFFER,a.U,c.DYNAMIC_DRAW);c.vertexAttribPointer(a.R,4,c.UNSIGNED_BYTE,!0,0,0);c.drawArrays(c.TRIANGLES,0,a.a/2)}requestAnimationFrame(this.A.bind(this))};
function M(a,b,d,c,e,f,h,k,r){ya(O.b,a,b,d,c,e,f,h,k,r)}function P(a,b,d,c){var e=O.b;a=a.toUpperCase().split("\n");for(var f=0;f<a.length;f++)for(var h=0;h<a[f].length;h++){var k=a[f].charCodeAt(h);33<=k&&127>=k&&ya(e,b+4*h,d+8*f,8*(k-33),0,8,10,c)}};var Ia=[0,0,16,17,23],Ja=[1,5,28,23,27],Ka=[2,0,1,3];var q=null,y=null,z=null,A=null;function B(a){var b=a.H,d=a.K,c=a.L;for(a=a.I;a<c;a++)for(var e=b;e<d;e++)p(e,a,La(e,a),!1)}function Aa(a,b,d){for(var c=Math.min(a,b);c<=Math.max(a,b);c++)p(c,d,La(c,d),!1)}function Ba(a,b,d){for(var c=Math.min(a,b);c<=Math.max(a,b);c++)p(d,c,La(d,c),!1)}function E(a,b){return Math.floor(Math.random()*(b-a)+a)}function Da(a,b){a=a/40|0;b=b/40|0;return 0>a||4<=a||0>b||4<=b?null:z[b][a]}
function La(a,b){a=(a=Da(a,b))?a.level:0;a=1+64*(9+a%3)+(5>a?16:20);return E(a,a+4)}function Ca(a,b){a=Da(a,b);a=64*(1+(a?a.level:0)%6)+17;return E(a,a+6)};var Ma=[{s:"Ok hotshot, teleportation complete.\nSystem check. Do you remember the mission?",options:[{text:"ROGER",u:"dialog",T:4},{text:"UH WHAT?",u:"dialog",T:1}]},{s:"Mother frakking... Teleportation glitch.\nYou're a lost cause. Want advice anyway?",options:[{text:"YES",u:"dialog",T:2},{text:"NO",u:"dialog",T:3}]},{s:"Alright.  Your brain is mush, but we'll try.\nFind the blaster in the room.",options:[{text:"COPY",u:"quest",Z:0}]},{s:"Alright.  Your brain is mush, and you're\nballs deep in aliens who want to kill you.  Good luck.",
options:[{text:"BYE"}]},{s:"Good. How do you wanna run this, soldier?\nWant me to guide you, or comms off?",options:[{text:"GUIDE",u:"dialog",T:5},{text:"COMMS OFF",u:"dialog",T:6}]},{s:"Alright.  First things first:\nFind the blaster in the room.",options:[{text:"OK",u:"quest",Z:0}]},{s:"Alright.  You know what you're doing.\nGo get em.",options:[{text:"OVER AND OUT"}]},{s:"Good.  Radar shows alien blood nearby.\nGo kill that ugly bastard.",options:[{text:"ACCEPT",u:"quest",Z:1},{text:"IGNORE"}]},
{s:"Not bad, soldier.  That took guts.\nFind a BLUE key to get out of this sector.",options:[{text:"ACCEPT",u:"quest",Z:2},{text:"IGNORE"}]},{s:"Excellent.  Let's get the frak out of here.\nFind the BLUE door to move to the next sector.",options:[{text:"ACCEPT",u:"quest",Z:3},{text:"IGNORE"}]}],Q=!1,Na=0,Oa=0,Pa;var Ha=[{title:"Find blaster",V:"item",i:2,W:7},{title:"First blood",V:"kill",i:1,W:8},{title:"Blue keycard",V:"item",i:3,W:9},{title:"Blue door",V:"item",i:3,W:9},{title:"Pick up radio",V:"item",i:4,W:0}],R=[];function Ga(a){S("Quest accepted: "+a.title,4294902015);R.push(a)}function Qa(a){S("Quest complete: "+a.title,4294902015);void 0!==a.W&&(a=a.W,Q=!0,Pa=!1,Na=a,Oa=Ra)};var Sa=[];function Ta(){Sa.push({x:L.x,y:L.y,frame:0})};var O=null,Ua=0,Va=0,T=0,Ra=0,x=null,G=null,H=null,Ea=null,J=null,K=null,L=null,Wa=!1,Xa=!1,Ya=0,Za=0,U=0,V=0,X=null,n=null,$a=0;
function ab(a,b){if(L=Y(a,b))x.target=null,x.path=null;else if(a=t(q,a,b),a!==x.target){var d=x.x/16|0,c=x.y/16|0;x.target=a;a=x;a:{b=x.target;for(var e=q,f=0;f<e.height;f++)for(var h=0;h<e.width;h++){var k=e.c[f][h];k.J=Infinity;k.ma=Math.min(Math.abs(h-b.x),Math.abs(f-b.y));k.oa=null}d=q.c[c][d];d.J=0;for(d=[d];0<d.length;){c=null;e=-1;f=Infinity;for(h=0;h<d.length;h++)k=d[h],Infinity!==k.J&&k.J+k.ma<f&&(c=k,e=h,f=k.J+k.ma);d.splice(e,1);if(c.x===b.x&&c.y===b.y){b=[];for(d=c;d;)b.push(d),d=d.oa;
b.reverse();break a}for(e=0;e<ka.length;e++)if(f=c.x+ka[e],h=c.y+la[e],0<=f&&f<q.width&&0<=h&&h<q.height){k=q.c[h][f];var r=c.J+ma[e];r<k.J&&20>=r&&!q.c[h][f].w&&(k.J=r,k.oa=c,d.push(k))}}b=null}a.path=b;x.Y=0}}function bb(a){return a.x+16>=K.x&&a.y+16>=K.y&&a.x<K.x+O.width&&a.y<K.y+O.height&&q.R(a.x/16|0,a.y/16|0)}function Y(a,b){for(var d=0;d<G.length;d++){var c=G[d];if(!(0>=c.l)&&(c.x/16|0)===a&&(c.y/16|0)===b)return c}return null}
function Fa(a,b){for(var d=0;20>d;d++){for(var c=a-d;c<=a+d;c++){var e=b-d;if(!u(c,e)&&null===Y(c,e))return{fa:c,ga:e};e=b+d;if(!u(c,e)&&null===Y(c,e))return{fa:c,ga:e}}for(c=b-d;c<=b+d;c++){e=a-d;if(!u(e,c)&&null===Y(e,c))return{fa:e,ga:c};e=a+d;if(!u(e,c)&&null===Y(e,c))return{fa:e,ga:c}}}return null}
function Z(a,b,d,c){a.direction=c;var e=Math.hypot(b,d);c=Math.floor(a.x/16)+b/e;e=Math.floor(a.y/16)+d/e;if(u(c,e))return!1;if(c=Y(c,e)){if(a.i===c.i)return!1;cb(a,c,2);a.B=18;Ta();return!0}a.D=b;a.F=d;a.B=16/Math.max(Math.abs(b),Math.abs(d));return!0}
function cb(a,b,d){b.l-=d;if(0>=b.l&&(b.l=0,S(b.name+" died",4278190335),b===L&&(L=null),0===a.i)){for(x.P+=10*b.level;x.P>=x.S;)x.P-=x.S,x.S*=2,x.level++,S("You are now level "+x.level,16711935);for(a=R.length-1;0<=a;a--)d=R[a],"kill"===d.V&&d.i===b.i&&(R.splice(a,1),Qa(d))}}function S(a,b){J.push({text:a,color:b});5<J.length&&J.splice(0,J.length-5)}
function db(){0===T&&G.sort(function(a,d){return Math.hypot(a.x-x.x,a.y-x.y)-Math.hypot(d.x-x.x,d.y-x.y)});T++;if(T>=G.length)for(var a=T=0;a<G.length;a++)0<G[a].l&&(G[a].m=1)}function eb(a){if(Q){var b=Ma[Na];0>a||a>b.options.length||(a=b.options[a],"dialog"===a.u?(a=a.T,Q=!0,Pa=!1,Na=a,Oa=Ra):"quest"===a.u?(Q=!1,Ga(Ha[a.Z])):Q=!1)}}O=new za;
O.update=function(){if(Q){if(!(30>Ra-Oa)){var a=(O.width-160)/2|0,b=(O.height-160)/2|0;1===X[32].C?Pa=!0:1===X[49].C||1===n.C&&ja(a,b+64)?eb(0):(1===X[50].C||1===n.C&&ja(a,b+80))&&eb(1)}}else if(Wa)1===X[78].h&&(Wa=!1);else if(0<x.l)for(;;){a=G[T];if(0<a.m&&0===a.B)if(0===T)a:if(0>=x.l)x.m=0;else{var d=x.x/16|0;b=x.y/16|0;var c=!1;if(0!==n.D||0!==n.F)Ya=n.x,Za=n.y,U=(K.x+Ya)/16|0,V=(K.y+Za)/16|0;if(Xa){if(1===X[98].h||1===X[40].h)Za+=16,V++;else if(1===X[100].h||1===X[37].h)Ya-=16,U--;else if(1===
X[102].h||1===X[39].h)Ya+=16,U++;else if(1===X[104].h||1===X[38].h)Za-=16,V--;else{if(1===X[27].h){x.target=null;x.path=null;Xa=!1;break a}1===X[13].h?Xa=!1:1===X[50].h&&(x.x=16*U,x.y=16*V,x.m=0,x.B=1,Xa=!1)}ab(U,V)}else{if(n.j)if(n.y>O.height-24)0<=n.x&&32>n.x&&(c=!0);else{ab((K.x+n.x)/16|0,(K.y+n.y)/16|0);break a}if(1===X[9].h){b=L?G.indexOf(L):0;for(var e=b+1;0===e||e>=G.length||0>=G[e].l||!bb(G[e]);)if(e++,e>=G.length&&(e=0),e===b){e=-1;break}0<e?L=G[e]:L=null}else if(1===X[13].h)Ya=x.x-K.x,Za=
x.y-K.y,U=x.x/16|0,V=x.y/16|0,Xa=!0,L=null;else if(1===X[78].h)Wa=!0;else{e=null;if(x.path){for(e=x.path[x.Y];e&&e.x===d&&e.y===b;)x.Y++,e=x.Y<x.path.length?x.path[x.Y]:null;e||(x.target=null,x.path=null)}var f=X[100].j||X[37].j||e&&e.x<d;d=X[102].j||X[39].j||e&&e.x>d;var h=X[104].j||X[38].j||e&&e.y<b,k=X[101].j;c=1===X[49].h||c;X[98].j||X[40].j||e&&e.y>b?Z(x,0,x.G,2):f?Z(x,-x.G,0,3):k?x.m=0:d?Z(x,x.G,0,1):h?Z(x,0,-x.G,0):c&&L&&0<x.da&&(Ta(),x.B=36,cb(x,L,5),x.da--)}}}else 0>=a.l?a.m=0:bb(a)?x.x<
a.x&&Z(a,-a.G,0,3)||x.x>a.x&&Z(a,a.G,0,1)||x.y<a.y&&Z(a,0,-a.G,0)||x.y>a.y&&Z(a,0,a.G,2)||0!==a.D||0!==a.F||(a.m=0):a.m=0;if(0<a.B){if(0!==a.D||0!==a.F)a.x+=a.D,a.y+=a.F;a.B--;if(0===a.B&&(a.D=0,a.F=0,a.m--,0===a.i)){for(b=H.length-1;0<=b;b--)if(e=H[b],e.x===a.x&&e.y===a.y)for(H.splice(b,1),Ea.push(e),S("Picked up: "+e.name,16777215),f=R.length-1;0<=f;f--)c=R[f],"item"===c.V&&c.i===e.i&&(R.splice(f,1),Qa(c));ua()}}0>=a.m&&(a.m=0,db());if(0===T&&0<a.m)break;if(0<a.B)break}X[65].j&&($a=10);Va++;16<
Va&&(Va=0,Ua++);if(O.b.aa&&O.b.aa.loaded){K.x=Math.max(0,x.x-(O.width/2|0)+8);K.y=Math.max(0,x.y-(O.height/2|0)+8);0<$a--&&(K.x+=4*Math.random()-2,K.y+=4*Math.random()-2);if(Q){if(Q&&(a=(O.width-160)/2|0,b=(O.height-160)/2|0,M(a+64,b,128,608,32,32),e=Ma[Na],f=Ra-Oa,f=Pa?e.s.length:Math.min(e.s.length,Math.floor(f/2)),P(e.s.substr(0,f),a,b+32),f===e.s.length))for(f=0;f<e.options.length;f++)P(e.options[f].text,a,b+64+16*f)}else{a=q;b=K.x;e=K.y;h=O.width;k=O.height;f=a.N;f.enable(f.BLEND);f.blendFunc(f.SRC_ALPHA,
f.ONE_MINUS_SRC_ALPHA);f.useProgram(a.a);f.bindBuffer(f.ARRAY_BUFFER,a.ia);f.enableVertexAttribArray(a.ha);f.enableVertexAttribArray(a.ca);f.vertexAttribPointer(a.ha,2,f.FLOAT,!1,16,0);f.vertexAttribPointer(a.ca,2,f.FLOAT,!1,16,8);a.U[0]=h;a.U[1]=k;f.uniform2fv(a.ua,a.U);f.activeTexture(f.TEXTURE0);f.uniform1i(a.ka,0);f.activeTexture(f.TEXTURE1);f.uniform1i(a.la,1);c=b/16|0;d=e/16|0;h=(b+h)/16|0;k=(e+k)/16|0;for(var r=0;r<a.b.length;r++){for(var l=a.b[r],m=d;m<=k;m++)for(var C=c;C<=h;C++){var w=a.R(C,
m)?255:(w=t(a,C,m))&&w.pa?144:0;l.O[4*(m*l.width+C)+3]=w}f.uniform2f(a.ta,b,e);f.uniform2fv(a.ja,l.va);f.bindTexture(f.TEXTURE_2D,l.qa);f.texSubImage2D(f.TEXTURE_2D,0,0,0,l.width,l.height,f.RGBA,f.UNSIGNED_BYTE,l.O);f.drawArrays(f.TRIANGLES,0,6)}x.target&&(a=16*x.target.x-K.x,b=16*x.target.y-K.y,e=640,u(x.target.x,x.target.y)&&(e=688),M(a,b,e,176,16,16));for(a=0;a<H.length;a++)b=H[a],bb(b)&&M(b.x-K.x,b.y-K.y,16*Ia[b.i],16*Ja[b.i],16,16);for(a=0;a<G.length;a++)b=G[a],bb(b)&&(e=b.x-K.x,f=b.y-K.y,0>=
b.l?(c=496,d=432):(c=16*(Ia[b.i]+Ka[b.direction]),d=16*(Ja[b.i]+Ua%2)),b===L&&M(e,f,720,176,16,16),M(e,f,c,d,16,16));for(a=Sa.length-1;0<=a;a--)b=Sa[a],M(b.x-K.x,b.y-K.y,128+16*Math.floor(b.frame/6),304,16,16),b.frame++,18<=b.frame&&Sa.splice(a,1);for(b=a=0;b<G.length;b++)e=G[b],e!==x&&0>=e.l||!bb(e)||(e===x?(f=e.l/e.X,P(e.name,0,a),M(0,a+7,544,208,32,12),M(2,a+9,544,224,8,8,void 0,Math.round(28*f)),P(e.l+"/"+e.X,0,a+10),f=x.da/x.ra,P("AMMO",32,a),M(32,a+7,544,208,32,12),M(34,a+9,552,224,8,8,void 0,
Math.round(28*f)),P(e.da+"/"+e.ra,32,a+10),f=x.P/x.S,P("LEVEL "+x.level,64,a),M(64,a+7,544,208,32,12),M(66,a+9,568,224,8,8,void 0,Math.round(28*f)),P(e.P+"/"+e.S,64,a+10)):(f=e.l/e.X,P(e.name,0,a),M(0,a+7,544,208,32,12),M(2,a+9,560,224,8,8,void 0,Math.round(28*f)),P(e.l+"/"+e.X,0,a+10)),a+=24);if(0<R.length)for(P("OBJECTIVES:",O.width-60,0),a=0;a<R.length;a++)P(R[a].title,O.width-60,8+8*a);a=O.height-24-8*J.length;for(b=0;b<J.length;b++)P(J[b].text,0,a+8*b,J[b].color);for(a=0;6>a;a++)M(24*a,O.height-
24,512,208,24,24),0===a&&M(24*a+4,O.height-24+4,256,448,16,16);Wa&&(M(0,0,512,256,144,144,128,O.width,O.height),a=(O.width-144)/2|0,b=(O.height-144)/2|0,M(a,b,512,256,144,144),M(a+10,b+9,480,416,16,16),P("2",a+21,b+19,16711935),M(a+22,b+33,464,416,16,16),P("0",a+33,b+43,16711935),M(a+22,b+57,624,160,16,16),P("0",a+33,b+67,16711935),M(a+22,b+81,448,416,16,16),P("0",a+33,b+91,16711935),M(a+56,b+9,336,416,16,16),P("0",a+67,b+19,16711935),M(a+68,b+33,336,448,16,16),P("0",a+79,b+43,16711935),M(a+68,b+
57,272,400,16,16),P("0",a+79,b+67,16711935),M(a+68,b+81,400,432,16,16),P("0",a+79,b+91,16711935),M(a+102,b+9,128,354,16,16),P("0",a+113,b+19,16711935),M(a+114,b+33,592,160,16,16),P("0",a+125,b+43,16711935),M(a+114,b+57,272,400,16,16),P("0",a+125,b+67,16711935),M(a+114,b+81,352,400,16,16),P("0",a+125,b+91,16711935),P("1: Leap 2 squares",a+8,b+106,4294967295),P("2: Leap 3 squares",a+8,b+114,4294967295),P("3: Leap 4 squares",a+8,b+122,16711935),P("4: Leap 5 squares",a+8,b+130,2155905279))}Ra++}};X=O.keys;
n=O.v;
