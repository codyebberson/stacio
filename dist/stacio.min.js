var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a,b){if(b){var c=ba;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}
ca("Math.hypot",function(a){return a?a:function(a,c,d){a=Number(a);c=Number(c);var b,f=Math.max(Math.abs(a),Math.abs(c));for(b=2;b<arguments.length;b++)f=Math.max(f,Math.abs(arguments[b]));if(1E100<f||1E-100>f){if(!f)return f;a/=f;c/=f;var h=a*a+c*c;for(b=2;b<arguments.length;b++){var l=Number(arguments[b])/f;h+=l*l}return Math.sqrt(h)*f}h=a*a+c*c;for(b=2;b<arguments.length;b++)l=Number(arguments[b]),h+=l*l;return Math.sqrt(h)}});function g(a,b,c,d){this.H=a;this.I=b;this.K=a+c;this.L=b+d;this.left=this.H;this.top=this.I;this.width=c;this.height=d;this.m=function(){return{x:(this.H+this.K)/2|0,y:(this.I+this.L)/2|0}};this.a=function(a){return this.H<=a.K&&this.K>=a.H&&this.I<=a.L&&this.L>=a.I}};function da(){this.j=!1;this.B=this.i=0}da.prototype.update=function(){this.j?(this.i++,this.B=0):(this.i=0,this.B++)};function ea(a){this.keys=Array(256);for(var b=0;256>b;b++)this.keys[b]=new da;a.tabIndex=0;var c=this;a.addEventListener("keydown",function(a){fa(c,a,!0)});a.addEventListener("keyup",function(a){fa(c,a,!1)})}ea.prototype.update=function(){for(var a=0;256>a;a++)this.keys[a].update()};function fa(a,b,c){b.stopPropagation();b.preventDefault();b=b.keyCode;0<=b&&256>b&&(a.keys[b].j=c)};function ha(a){this.a=a;this.F=this.D=this.y=this.x=0;this.j=!1;this.B=this.i=0;var b=this.b.bind(this);a.addEventListener("mousedown",b);a.addEventListener("mouseup",b);a.addEventListener("mousemove",b);a.addEventListener("contextmenu",b);b=this.f.bind(this);a.addEventListener("touchstart",b);a.addEventListener("touchend",b);a.addEventListener("touchcancel",b);a.addEventListener("touchmove",b)}ha.prototype.update=function(){this.j?(this.i++,this.B=0):(this.i=0,this.B++)};
ha.prototype.b=function(a){a.stopPropagation();a.preventDefault();ia(this,a.clientX,a.clientY);"mousedown"===a.type&&(this.j=!0,this.a.focus());"mouseup"===a.type&&(this.j=!1)};ha.prototype.f=function(a){a.stopPropagation();a.preventDefault();0<a.touches.length?(a=a.touches[0],ia(this,a.clientX,a.clientY),this.j=!0):this.j=!1};
function ia(a,b,c){var d=a.a.getBoundingClientRect(),e=d.width/d.height;if(.01<e-n){var f=n*d.height;d=new g(Math.floor((d.width-f)/2),0,f,d.height)}-.01>e-n&&(e=d.width/n,d=new g(0,Math.floor((d.height-e)/2),d.width,e));e=a.x;f=a.y;a.x=p*(b-d.left)/d.width|0;a.y=q*(c-d.top)/d.height|0;a.D=a.x-e;a.F=a.y-f}function ja(a,b){return t.x>=a&&t.x<a+80&&t.y>=b&&t.y<b+8};var ka=[0,-1,1,0],la=[-1,0,0,1],ma=[1,1,1,1];
function na(a){for(var b=w.target,c=x,d=0;d<c.height;d++)for(var e=0;e<c.width;e++){var f=c.c[d][e];f.J=Infinity;f.ma=Math.min(Math.abs(e-b.x),Math.abs(d-b.y));f.oa=null}a=x.c[a.y][a.x];a.J=0;for(a=[a];0<a.length;){c=null;d=-1;e=Infinity;for(f=0;f<a.length;f++){var h=a[f];Infinity!==h.J&&h.J+h.ma<e&&(c=h,d=f,e=h.J+h.ma)}a.splice(d,1);if(c.x===b.x&&c.y===b.y){b=[];for(a=c;a;)b.push(a),a=a.oa;b.reverse();return b}for(d=0;d<ka.length;d++)if(e=c.x+ka[d],f=c.y+la[d],0<=e&&e<x.width&&0<=f&&f<x.height){h=
x.c[f][e];var l=c.J+ma[d];l<h.J&&20>=l&&!x.c[f][e].w&&(h.J=l,h.oa=c,a.push(h))}}return null};function oa(a,b,c){b=pa(a,a.VERTEX_SHADER,b);c=pa(a,a.FRAGMENT_SHADER,c);var d=a.createProgram();a.attachShader(d,b);a.attachShader(d,c);a.linkProgram(d);return d}function pa(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);return b}
function qa(a){var b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);var c=a.RGBA,d=a.RGBA,e=a.UNSIGNED_BYTE;a.texImage2D(a.TEXTURE_2D,0,c,1,1,0,d,e,new Uint8Array([0,0,0,0]));var f=new Image;f.onload=function(){a.bindTexture(a.TEXTURE_2D,b);a.texImage2D(a.TEXTURE_2D,0,c,d,e,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,
a.NEAREST);a.generateMipmap(a.TEXTURE_2D);b.loaded=!0;b.width=f.width;b.height=f.height};f.src="img/graphics.png";return b};function ra(a,b){this.x=a;this.y=b;this.sa=0;this.w=!0;this.pa=this.visible=!1;this.ma=this.J=0;this.oa=null}function sa(){this.height=this.width=256;this.qa=null;this.N=new Uint8Array(262144);this.va=new Float32Array([256,256]);this.clear()}sa.prototype.clear=function(){for(var a=0;a<this.N.length;a++)this.N[a]=255};
sa.prototype.na=function(a){this.qa=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.qa);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,this.N);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)};
function ta(){this.height=this.width=256;this.c=Array(256);this.b=Array(3);this.T=new Float32Array(2);for(var a=0;256>a;a++){this.c[a]=Array(256);for(var b=0;256>b;b++)this.c[a][b]=new ra(b,a)}for(a=0;3>a;a++)this.b[a]=new sa}
ta.prototype.na=function(a){this.X=a;this.ia=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.ia);a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,-1,0,1,1,1,1,0,-1,1,0,0]),a.STATIC_DRAW);this.a=oa(a,"precision highp float;attribute vec2 position;attribute vec2 texture;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 viewOffset;uniform vec2 viewportSize;uniform vec2 mapSize;void main(void) {   pixelCoord = (texture * viewportSize) + viewOffset;   texCoord = pixelCoord / mapSize / 16.0;   gl_Position = vec4(position, 0.0, 1.0);}","precision highp float;varying vec2 pixelCoord;varying vec2 texCoord;uniform sampler2D tiles;uniform sampler2D sprites;void main(void) {   vec4 tile = texture2D(tiles, texCoord);   if(tile.x == 1.0 && tile.y == 1.0) { discard; }   vec2 spriteOffset = floor(tile.xy * 256.0) * 16.0;   vec2 spriteCoord = mod(pixelCoord, 16.0);   gl_FragColor = texture2D(sprites, (spriteOffset + spriteCoord) / 1024.0);   gl_FragColor.a = tile.a;}");
this.ha=a.getAttribLocation(this.a,"position");this.ca=a.getAttribLocation(this.a,"texture");this.ua=a.getUniformLocation(this.a,"viewportSize");this.ta=a.getUniformLocation(this.a,"viewOffset");this.ja=a.getUniformLocation(this.a,"mapSize");this.la=a.getUniformLocation(this.a,"tiles");this.ka=a.getUniformLocation(this.a,"sprites");for(var b=0;b<this.b.length;b++)this.b[b].na(a)};
function y(a,b,c,d){var e=x;e.c[b][a].sa=c;e.c[b][a].w=d;d=e.b[0];a=4*(b*d.width+a);d.N[a]=0===c?255:(c-1)%64|0;d.N[a+1]=0===c?255:(c-1)/64|0}function z(a,b,c){return 0>b||b>=a.width||0>c||c>=a.height?null:a.c[c][b]}function ua(a,b){return(a=z(x,a,b))?a.sa:81}function A(a,b){a=z(x,a,b);return!a||a.w}ta.prototype.P=function(a,b){return(a=z(this,a,b))&&a.visible};ta.prototype.P=function(a,b){return a<this.v||a>this.f||b<this.A||b>this.h?!1:this.c[b][a].visible};function va(){var a=x,b=w.x/16|0,c=w.y/16|0;a.$=b;a.ba=c;a.v=Math.max(0,b-12);a.A=Math.max(0,c-12);a.f=Math.min(a.width-1,b+12);a.h=Math.min(a.height-1,c+12);for(var d=a.A;d<=a.h;d++)for(var e=a.v;e<=a.f;e++)a.c[d][e].pa|=a.c[d][e].visible,a.c[d][e].visible=!1;a.c[c][b].visible=!0;wa(a,1,1);xa(a,1,1);wa(a,1,-1);xa(a,1,-1);wa(a,-1,1);xa(a,-1,1);wa(a,-1,-1);xa(a,-1,-1)}
function wa(a,b,c){var d=[],e=[],f=1,h=0,l=0,u=0,k,m;for(m=a.ba+c;m>=a.A&&m<=a.h;m+=c,l=h,++f){var C=.5/f;var v=-1;var J=Math.floor(u*f+.5);for(k=a.$+J*b;J<=f&&k>=a.v&&k<=a.f;k+=b,++J,v=D){var G=!0;var Z=!1;var P=J/f;var D=P+C;if(0<l)if(a.c[m-c][k].visible&&!a.c[m-c][k].w||a.c[m-c][k-b].visible&&!a.c[m-c][k-b].w)for(var r=0;r<l&&G;++r){if(v<=e[r]&&D>=d[r])if(a.c[m][k].w)if(v>=d[r]&&D<=e[r]){G=!1;break}else d[r]=Math.min(d[r],v),e[r]=Math.max(e[r],D),Z=!0;else if(P>d[r]&&P<e[r]){G=!1;break}}else G=
!1;G&&(a.c[m][k].visible=!0,a.c[m][k].w&&(u>=v?u=D:Z||(d[h]=v,e[h++]=D)))}}}
function xa(a,b,c){var d=[],e=[],f=1,h=0,l=0,u=0,k,m;for(k=a.$+b;k>=a.v&&k<=a.f;k+=b,l=h,++f){var C=.5/f;var v=-1;var J=Math.floor(u*f+.5);for(m=a.ba+J*c;J<=f&&m>=a.A&&m<=a.h;m+=c,++J,v=D){var G=!0;var Z=!1;var P=J/f;var D=P+C;if(0<l)if(a.c[m][k-b].visible&&!a.c[m][k-b].w||a.c[m-c][k-b].visible&&!a.c[m-c][k-b].w)for(var r=0;r<l&&G;++r){if(v<=e[r]&&D>=d[r])if(a.c[m][k].w)if(v>=d[r]&&D<=e[r]){G=!1;break}else d[r]=Math.min(d[r],v),e[r]=Math.max(e[r],D),Z=!0;else if(P>d[r]&&P<e[r]){G=!1;break}}else G=
!1;G&&(a.c[m][k].visible=!0,a.c[m][k].w&&(u>=v?u=D:Z||(d[h]=v,e[h++]=D)))}}};function ya(a){this.X=a;var b=oa(a,"uniform vec2 u_viewportSize;attribute vec2 a_position;attribute vec2 a_texCoord;attribute vec4 a_color;varying vec2 v_texCoord;varying vec4 v_color;void main() {vec2 zeroToOne = a_position / u_viewportSize;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;v_color = a_color;}","precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;varying vec4 v_color;void main() {gl_FragColor = texture2D(u_image, v_texCoord);if (gl_FragColor.a < 0.1) discard;if (v_color.a > 0.5) gl_FragColor = v_color;}");
this.ja=b;this.la=a.getUniformLocation(b,"u_viewportSize");this.$=a.getAttribLocation(b,"a_position");this.ba=a.getAttribLocation(b,"a_texCoord");this.P=a.getAttribLocation(b,"a_color");this.A=new Float32Array(2);this.ca=a.createBuffer();this.ka=a.createBuffer();this.ha=a.createBuffer();this.aa=qa(a);this.b=new Float32Array(65536);this.a=0;this.f=new Float32Array(65536);this.h=0;this.T=new Uint8Array(65536);this.ia=new DataView(this.T.buffer);this.v=0}
function za(a,b,c,d,e,f,h,l,u,k){var m=a.aa;if(m.loaded){u=b+Math.abs(void 0!==u?u:f);k=c+(void 0!==k?k:h);var C=d/m.width,v=e/m.height;d=(d+f)/m.width;e=(e+h)/m.height;l=l||0;a.b[a.a++]=b;a.b[a.a++]=c;a.b[a.a++]=u;a.b[a.a++]=c;a.b[a.a++]=b;a.b[a.a++]=k;a.f[a.h++]=C;a.f[a.h++]=v;a.f[a.h++]=d;a.f[a.h++]=v;a.f[a.h++]=C;a.f[a.h++]=e;a.b[a.a++]=b;a.b[a.a++]=k;a.b[a.a++]=u;a.b[a.a++]=c;a.b[a.a++]=u;a.b[a.a++]=k;a.f[a.h++]=C;a.f[a.h++]=e;a.f[a.h++]=d;a.f[a.h++]=v;a.f[a.h++]=d;a.f[a.h++]=e;for(b=0;6>b;b++)a.ia.setUint32(a.v,
l,!1),a.v+=4}};function Aa(){var a=document.querySelector("canvas"),b=a.getContext("webgl",{alpha:!1,antialias:!1});if(b){this.b=a;this.options={};this.X=b;b.disable(b.DEPTH_TEST);b.enable(b.BLEND);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);this.a=new ya(b);this.h=new ea(a);this.keys=this.h.keys;this.v=new ha(a);x=new ta;B=[];E=[];Ba=[];for(a=0;4>a;a++){E.push(Array(4));for(var c=0;4>c;c++)E[a][c]=null}for(a=0;10>a;a++){c={level:a,x:0,y:0,parent:null,M:0,children:[],ea:[]};if(0===a)c.x=Math.floor(4*Math.random()),
c.y=Math.floor(4*Math.random());else{var d=Ba[Math.floor(Math.random()*Ba.length)];d.children.push(c);d.M--;c.parent=d;0<d.x&&!E[d.y][d.x-1]&&(c.x=d.x-1,c.y=d.y);0<d.y&&!E[d.y-1][d.x]&&(c.x=d.x,c.y=d.y-1);3>d.x&&!E[d.y][d.x+1]&&(c.x=d.x+1,c.y=d.y);3>d.y&&!E[d.y+1][d.x]&&(c.x=d.x,c.y=d.y+1)}c.rect=new g(40*c.x,40*c.y,40,40);B.push(c);E[c.y][c.x]=c;Ba=[];for(c=0;c<B.length;c++)d=B[c],d.M=0,0<d.x&&!E[d.y][d.x-1]&&d.M++,0<d.y&&!E[d.y-1][d.x]&&d.M++,3>d.x&&!E[d.y][d.x+1]&&d.M++,3>d.y&&!E[d.y+1][d.x]&&
d.M++,0<d.M&&Ba.push(d)}for(a=0;a<B.length;a++){c=B[a];d=c.ea;var e=new g(c.rect.H+1,c.rect.m().y-2,5,5);Ca(e);d.push(e);e=new g(c.rect.K-5,c.rect.m().y-2,5,5);Ca(e);d.push(e);e=new g(c.rect.m().x-2,c.rect.I+1,5,5);Ca(e);d.push(e);e=new g(c.rect.m().x-2,c.rect.L-5,5,5);Ca(e);for(d.push(e);10>d.length;){e=new g(F(c.rect.H+2,c.rect.K-12-3),F(c.rect.I+2,c.rect.L-8-3),F(5,12),F(5,8));for(var f=!1,h=0;h<d.length;h++)if(e.a(d[h])){f=!0;break}f||(Ca(e),d.push(e))}for(e=d.length-1;0<e;e--)h=Math.floor(Math.random()*
(e+1)),f=d[e],d[e]=d[h],d[h]=f;for(e=1;e<d.length;e++)f=d[e].m(),h=d[e-1].m(),.5>Math.random()?(Da(h.x,f.x,h.y),Ea(h.y,f.y,f.x)):(Ea(h.y,f.y,h.x),Da(h.x,f.x,f.y));c.parent&&(c.parent.x<c.x?Da(c.rect.H-3,c.rect.H+3,c.rect.m().y):c.parent.x>c.x?Da(c.rect.K-3,c.rect.K+3,c.rect.m().y):c.parent.y<c.y?Ea(c.rect.I-3,c.rect.I+3,c.rect.m().x):c.parent.y>c.y&&Ea(c.rect.L-3,c.rect.L+3,c.rect.m().x))}for(a=0;256>a;a++)for(c=0;256>c;c++)A(c,a)&&(A(c,a+1)?0!==ua(c,a)&&0===ua(c,a+1)?y(c,a,Fa(c,a),!0):A(c,a-1)&&
A(c-1,a)&&A(c+1,a)&&A(c-1,a-1)&&A(c+1,a-1)&&A(c-1,a+1)&&A(c+1,a+1)||(d=Ga(c,a),d=64*(1+(d?d.level:0)%6)+23,y(c,a,F(d,d+6),!0)):y(c,a,Fa(c,a),!0));w={g:0,name:"Player",x:16*B[0].ea[0].m().x,y:16*B[0].ea[0].m().y,D:0,F:0,direction:2,l:100,Y:100,u:1,C:0,G:2,target:null,path:null,V:0,da:100,ra:100,O:0,R:10,level:1};a={g:4,name:"Radio",x:w.x+32,y:w.y-32};c={g:2,name:"Blaster",x:w.x+32,y:w.y+32};H=[w];I=[a,c];Ha=[];K=[];L={x:0,y:0};M=null;for(a=0;a<B.length;a++)for(c=B[a],d=c.ea,e=1;e<d.length;e++){f=d[e].m();
h=c.level/3|1;for(var l=0;l<h;l++){var u=Ia(f.x,f.y);if(!u)break;H.push({g:1,level:c.level+1,name:"Alien ("+(c.level+1)+")",x:16*u.fa,y:16*u.ga,D:0,F:0,direction:2,l:10+5*c.level,Y:10+5*c.level,u:1,C:0,G:4})}8===e&&I.push({g:3,name:"Blue Key",x:16*f.x+32,y:16*f.y+32})}va();Ja(Ka[4]);x.na(b);window.addEventListener("resize",this.f.bind(this),!1);this.f();this.A()}}
Aa.prototype.f=function(){var a=window.innerWidth,b=window.innerHeight;var c=a>b?Math.max(1,Math.min(Math.floor(a/256),Math.floor(b/144))):Math.max(1,Math.min(Math.floor(a/144),Math.floor(b/256)));p=Math.round(a/c);q=Math.round(b/c);n=p/q;this.b.width=p;this.b.height=q;this.b.style.left="0";this.b.style.top="0";this.b.style.width=a+"px";this.b.style.height=b+"px"};
Aa.prototype.A=function(){this.h.update();this.v.update();var a=this.X;a.viewport(0,0,p,q);a.clearColor(0,0,0,1);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);this.a.a=0;this.a.h=0;this.a.v=0;this.update&&this.update();a=this.a;if(a.aa.loaded){var b=a.X;b.useProgram(a.ja);a.A[0]=p;a.A[1]=q;b.uniform2fv(a.la,a.A);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,a.aa);b.enableVertexAttribArray(a.$);b.bindBuffer(b.ARRAY_BUFFER,a.ca);b.bufferData(b.ARRAY_BUFFER,a.b,b.DYNAMIC_DRAW);b.vertexAttribPointer(a.$,
2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(a.ba);b.bindBuffer(b.ARRAY_BUFFER,a.ka);b.bufferData(b.ARRAY_BUFFER,a.f,b.DYNAMIC_DRAW);b.vertexAttribPointer(a.ba,2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(a.P);b.bindBuffer(b.ARRAY_BUFFER,a.ha);b.bufferData(b.ARRAY_BUFFER,a.T,b.DYNAMIC_DRAW);b.vertexAttribPointer(a.P,4,b.UNSIGNED_BYTE,!0,0,0);b.drawArrays(b.TRIANGLES,0,a.a/2)}requestAnimationFrame(this.A.bind(this))};function N(a,b,c,d,e,f,h,l,u){za(O.a,a,b,c,d,e,f,h,l,u)}
function Q(a,b,c,d){var e=O.a;a=a.split("\n");for(var f=0;f<a.length;f++)for(var h=0;h<a[f].length;h++){var l=a[f].charCodeAt(h);33<=l&&127>=l&&za(e,b+4*h,c+8*f,8*(l-33),0,8,10,d)}};var p=256,q=144,n=p/q,La=[0,0,16,17,23],Ma=[1,5,28,23,27],Na=[2,0,1,3];var x=null,B=null,E=null,Ba=null;function Ca(a){var b=a.H,c=a.K,d=a.L;for(a=a.I;a<d;a++)for(var e=b;e<c;e++)y(e,a,Oa(e,a),!1)}function Da(a,b,c){for(var d=Math.min(a,b);d<=Math.max(a,b);d++)y(d,c,Oa(d,c),!1)}function Ea(a,b,c){for(var d=Math.min(a,b);d<=Math.max(a,b);d++)y(c,d,Oa(c,d),!1)}function F(a,b){return Math.floor(Math.random()*(b-a)+a)}function Ga(a,b){a=a/40|0;b=b/40|0;return 0>a||4<=a||0>b||4<=b?null:E[b][a]}
function Oa(a,b){a=(a=Ga(a,b))?a.level:0;a=1+64*(9+a%3)+(5>a?16:20);return F(a,a+4)}function Fa(a,b){a=Ga(a,b);a=64*(1+(a?a.level:0)%6)+17;return F(a,a+6)};var Pa=[{o:"Ok hotshot, teleportation complete.\nSystem check. Do you remember the mission?",options:[{text:"ROGER",s:"dialog",S:4},{text:"UH WHAT?",s:"dialog",S:1}]},{o:"Mother frakking... Teleportation glitch.\nYou're a lost cause. Want advice anyway?",options:[{text:"YES",s:"dialog",S:2},{text:"NO",s:"dialog",S:3}]},{o:"Alright.  Your brain is mush, but we'll try.\nFind the blaster in the room.",options:[{text:"COPY",s:"quest",Z:0}]},{o:"Alright.  Your brain is mush, and you're\nballs deep in aliens who want to kill you.  Good luck.",
options:[{text:"BYE"}]},{o:"Good. How do you wanna run this, soldier?\nWant me to guide you, or comms off?",options:[{text:"GUIDE",s:"dialog",S:5},{text:"COMMS OFF",s:"dialog",S:6}]},{o:"Alright.  First things first:\nFind the blaster in the room.",options:[{text:"OK",s:"quest",Z:0}]},{o:"Alright.  You know what you're doing.\nGo get em.",options:[{text:"OVER AND OUT"}]},{o:"Good.  Radar shows alien blood nearby.\nGo kill that ugly bastard.",options:[{text:"ACCEPT",s:"quest",Z:1},{text:"IGNORE"}]},
{o:"Not bad, soldier.  That took guts.\nFind a BLUE key to get out of this sector.",options:[{text:"ACCEPT",s:"quest",Z:2},{text:"IGNORE"}]},{o:"Excellent.  Let's get the frak out of here.\nFind the BLUE door to move to the next sector.",options:[{text:"ACCEPT",s:"quest",Z:3},{text:"IGNORE"}]}],R=!1,Qa=0,Ra=0,Sa;var Ka=[{title:"Find blaster",U:"item",g:2,W:7},{title:"First blood",U:"kill",g:1,W:8},{title:"Blue keycard",U:"item",g:3,W:9},{title:"Blue door",U:"item",g:3,W:9},{title:"Pick up radio",U:"item",g:4,W:0}],S=[];function Ja(a){Ta("Quest accepted: "+a.title,4294902015);S.push(a)}function Ua(a){Ta("Quest complete: "+a.title,4294902015);void 0!==a.W&&(a=a.W,R=!0,Sa=!1,Qa=a,Ra=Va)};var O=null,Wa=0,Xa=0,T=0,Va=0,w=null,H=null,I=null,Ha=null,K=null,L=null,M=null,Ya=!1,Za=!1,$a=0,ab=0,U=0,V=0,W=null,t=null,bb=[],cb=0;function db(a){return a.x+16>=L.x&&a.y+16>=L.y&&a.x<L.x+p&&a.y<L.y+q&&x.P(a.x/16|0,a.y/16|0)}function X(a,b){for(var c=0;c<H.length;c++){var d=H[c];if(!(0>=d.l)&&(d.x/16|0)===a&&(d.y/16|0)===b)return d}return null}
function Ia(a,b){for(var c=0;20>c;c++){for(var d=a-c;d<=a+c;d++){var e=b-c;if(!A(d,e)&&null===X(d,e))return{fa:d,ga:e};e=b+c;if(!A(d,e)&&null===X(d,e))return{fa:d,ga:e}}for(d=b-c;d<=b+c;d++){e=a-c;if(!A(e,d)&&null===X(e,d))return{fa:e,ga:d};e=a+c;if(!A(e,d)&&null===X(e,d))return{fa:e,ga:d}}}return null}
function Y(a,b,c,d){a.direction=d;var e=Math.hypot(b,c);d=Math.floor(a.x/16)+b/e;e=Math.floor(a.y/16)+c/e;if(A(d,e))return!1;if(d=X(d,e)){if(a.g===d.g)return!1;eb(a,d,2);a.C=18;bb.push({x:d.x,y:d.y,frame:0});return!0}a.D=b;a.F=c;a.C=16/Math.max(Math.abs(b),Math.abs(c));return!0}
function eb(a,b,c){b.l-=c;if(0>=b.l&&(b.l=0,Ta(b.name+" died",4278190335),b===M&&(M=null),0===a.g)){for(w.O+=10*b.level;w.O>=w.R;)w.O-=w.R,w.R*=2,w.level++,Ta("You are now level "+w.level,16711935);for(a=S.length-1;0<=a;a--)c=S[a],"kill"===c.U&&c.g===b.g&&(S.splice(a,1),Ua(c))}}function Ta(a,b){K.push({text:a,color:b});5<K.length&&K.splice(0,K.length-5)}
function fb(){0===T&&H.sort(function(a,c){return Math.hypot(a.x-w.x,a.y-w.y)-Math.hypot(c.x-w.x,c.y-w.y)});T++;if(T>=H.length)for(var a=T=0;a<H.length;a++)0<H[a].l&&(H[a].u=1)}function gb(a){if(R){var b=Pa[Qa];0>a||a>b.options.length||(a=b.options[a],"dialog"===a.s?(a=a.S,R=!0,Sa=!1,Qa=a,Ra=Va):"quest"===a.s?(R=!1,Ja(Ka[a.Z])):R=!1)}}O=new Aa;
O.update=function(){if(R){if(!(30>Va-Ra)){var a=(p-160)/2|0,b=(q-160)/2|0;1===W[32].B?Sa=!0:1===W[49].B||1===t.B&&ja(a,b+64)?gb(0):(1===W[50].B||1===t.B&&ja(a,b+80))&&gb(1)}}else if(Ya)1===W[78].i&&(Ya=!1);else if(0<w.l)for(;;){a=H[T];if(0<a.u&&0===a.C)if(0===T)a:if(0>=w.l)w.u=0;else{var c=w.x/16|0;b=w.y/16|0;var d=!1;if(0!==t.D||0!==t.F)$a=t.x,ab=t.y,U=(L.x+$a)/16|0,V=(L.y+ab)/16|0;if(Za){1===W[98].i||1===W[40].i?(ab+=16,V++):1===W[100].i||1===W[37].i?($a-=16,U--):1===W[102].i||1===W[39].i?($a+=
16,U++):1===W[104].i||1===W[38].i?(ab-=16,V--):1===W[27].i?(w.target=null,w.path=null,Za=!1):1===W[13].i&&(Za=!1);var e=z(x,U,V);e!==w.target&&(b={x:c,y:b},w.target=e,w.path=na(b),w.V=0)}else{if(t.j)if(t.y>q-24)0<=t.x&&32>t.x&&(d=!0);else{e=U;var f=V;if(M=X(e,f)){w.target=null;w.path=null;break a}e=z(x,e,f);e!==w.target&&(b={x:c,y:b},w.target=e,w.path=na(b),w.V=0);break a}if(1===W[9].i){b=M?H.indexOf(M):0;for(c=b+1;0===c||c>=H.length||0>=H[c].l||!db(H[c]);)if(c++,c>=H.length&&(c=0),c===b){c=-1;break}0<
c?M=H[c]:M=null}else if(1===W[13].i)$a=w.x-L.x,ab=w.y-L.y,U=w.x/16|0,V=w.y/16|0,Za=!0;else if(1===W[78].i)Ya=!0;else{e=null;if(w.path){for(e=w.path[w.V];e&&e.x===c&&e.y===b;)w.V++,e=w.V<w.path.length?w.path[w.V]:null;e||(w.target=null,w.path=null)}f=W[100].j||W[37].j||e&&e.x<c;c=W[102].j||W[39].j||e&&e.x>c;var h=W[104].j||W[38].j||e&&e.y<b,l=W[101].j;d=1===W[49].i||d;W[98].j||W[40].j||e&&e.y>b?Y(w,0,w.G,2):f?Y(w,-w.G,0,3):l?w.u=0:c?Y(w,w.G,0,1):h?Y(w,0,-w.G,0):d&&M&&0<w.da&&(bb.push({x:M.x,y:M.y,
frame:0}),w.C=36,eb(w,M,5),w.da--)}}}else 0>=a.l?a.u=0:db(a)?w.x<a.x&&Y(a,-a.G,0,3)||w.x>a.x&&Y(a,a.G,0,1)||w.y<a.y&&Y(a,0,-a.G,0)||w.y>a.y&&Y(a,0,a.G,2)||0!==a.D||0!==a.F||(a.u=0):a.u=0;if(0<a.C){if(0!==a.D||0!==a.F)a.x+=a.D,a.y+=a.F;a.C--;if(0===a.C&&(a.D=0,a.F=0,a.u--,0===a.g)){for(b=I.length-1;0<=b;b--)if(c=I[b],c.x===a.x&&c.y===a.y)for(I.splice(b,1),Ha.push(c),Ta("Picked up: "+c.name,16777215),e=S.length-1;0<=e;e--)f=S[e],"item"===f.U&&f.g===c.g&&(S.splice(e,1),Ua(f));va()}}0>=a.u&&(a.u=0,fb());
if(0===T&&0<a.u)break;if(0<a.C)break}W[65].j&&(cb=10);Xa++;16<Xa&&(Xa=0,Wa++);if(O.a.aa&&O.a.aa.loaded){L.x=Math.max(0,w.x-(p/2|0)+8);L.y=Math.max(0,w.y-(q/2|0)+8);0<cb--&&(L.x+=4*Math.random()-2,L.y+=4*Math.random()-2);if(R){if(R&&(a=(p-160)/2|0,b=(q-160)/2|0,N(a+64,b,128,608,32,32),c=Pa[Qa],e=Va-Ra,e=Sa?c.o.length:Math.min(c.o.length,Math.floor(e/2)),Q(c.o.substr(0,e),a,b+32),e===c.o.length))for(e=0;e<c.options.length;e++)Q(c.options[e].text,a,b+64+16*e)}else{a=x;b=L.x;c=L.y;h=p;l=q;e=a.X;e.enable(e.BLEND);
e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);e.useProgram(a.a);e.bindBuffer(e.ARRAY_BUFFER,a.ia);e.enableVertexAttribArray(a.ha);e.enableVertexAttribArray(a.ca);e.vertexAttribPointer(a.ha,2,e.FLOAT,!1,16,0);e.vertexAttribPointer(a.ca,2,e.FLOAT,!1,16,8);a.T[0]=h;a.T[1]=l;e.uniform2fv(a.ua,a.T);e.activeTexture(e.TEXTURE0);e.uniform1i(a.ka,0);e.activeTexture(e.TEXTURE1);e.uniform1i(a.la,1);f=b/16|0;d=c/16|0;h=(b+h)/16|0;l=(c+l)/16|0;for(var u=0;u<a.b.length;u++){for(var k=a.b[u],m=d;m<=l;m++)for(var C=
f;C<=h;C++){var v=a.P(C,m)?255:(v=z(a,C,m))&&v.pa?144:0;k.N[4*(m*k.width+C)+3]=v}e.uniform2f(a.ta,b,c);e.uniform2fv(a.ja,k.va);e.bindTexture(e.TEXTURE_2D,k.qa);e.texSubImage2D(e.TEXTURE_2D,0,0,0,k.width,k.height,e.RGBA,e.UNSIGNED_BYTE,k.N);e.drawArrays(e.TRIANGLES,0,6)}w.target&&(a=16*w.target.x-L.x,b=16*w.target.y-L.y,c=640,A(w.target.x,w.target.y)&&(c=688),N(a,b,c,176,16,16));for(a=0;a<I.length;a++)b=I[a],db(b)&&N(b.x-L.x,b.y-L.y,16*La[b.g],16*Ma[b.g],16,16);for(a=0;a<H.length;a++)b=H[a],db(b)&&
(c=b.x-L.x,e=b.y-L.y,0>=b.l?(f=496,d=432):(f=16*(La[b.g]+Na[b.direction]),d=16*(Ma[b.g]+Wa%2)),b===M&&N(c,e,720,176,16,16),N(c,e,f,d,16,16));for(a=bb.length-1;0<=a;a--)b=bb[a],N(b.x-L.x,b.y-L.y,128+16*Math.floor(b.frame/6),304,16,16),b.frame++,18<=b.frame&&bb.splice(a,1);for(b=a=0;b<H.length;b++)c=H[b],c!==w&&0>=c.l||!db(c)||(c===w?(e=c.l/c.Y,Q(c.name,0,a),N(0,a+7,544,208,32,12),N(2,a+9,544,224,8,8,void 0,Math.round(28*e)),Q(c.l+"/"+c.Y,0,a+10),e=w.da/w.ra,Q("AMMO",32,a),N(32,a+7,544,208,32,12),N(34,
a+9,552,224,8,8,void 0,Math.round(28*e)),Q(c.da+"/"+c.ra,32,a+10),e=w.O/w.R,Q("LEVEL "+w.level,64,a),N(64,a+7,544,208,32,12),N(66,a+9,568,224,8,8,void 0,Math.round(28*e)),Q(c.O+"/"+c.R,64,a+10)):(e=c.l/c.Y,Q(c.name,0,a),N(0,a+7,544,208,32,12),N(2,a+9,560,224,8,8,void 0,Math.round(28*e)),Q(c.l+"/"+c.Y,0,a+10)),a+=24);if(0<S.length)for(Q("OBJECTIVES:",p-60,0),a=0;a<S.length;a++)Q(S[a].title,p-60,8+8*a);a=q-24-8*K.length;for(b=0;b<K.length;b++)Q(K[b].text,0,a+8*b,K[b].color);for(a=0;6>a;a++)N(24*a,q-
24,512,208,24,24),0===a&&N(24*a+4,q-24+4,256,448,16,16);Ya&&(N(0,0,512,256,144,144,128,p,q),a=(p-144)/2|0,b=(q-144)/2|0,N(a,b,512,256,144,144),N(a+10,b+9,480,416,16,16),Q("2",a+21,b+19,16711935),N(a+22,b+33,464,416,16,16),Q("0",a+33,b+43,16711935),N(a+22,b+57,624,160,16,16),Q("0",a+33,b+67,16711935),N(a+22,b+81,448,416,16,16),Q("0",a+33,b+91,16711935),N(a+56,b+9,336,416,16,16),Q("0",a+67,b+19,16711935),N(a+68,b+33,336,448,16,16),Q("0",a+79,b+43,16711935),N(a+68,b+57,272,400,16,16),Q("0",a+79,b+67,
16711935),N(a+68,b+81,400,432,16,16),Q("0",a+79,b+91,16711935),N(a+102,b+9,128,354,16,16),Q("0",a+113,b+19,16711935),N(a+114,b+33,592,160,16,16),Q("0",a+125,b+43,16711935),N(a+114,b+57,272,400,16,16),Q("0",a+125,b+67,16711935),N(a+114,b+81,352,400,16,16),Q("0",a+125,b+91,16711935),Q("1: Leap 2 squares",a+8,b+106,4294967295),Q("2: Leap 3 squares",a+8,b+114,4294967295),Q("3: Leap 4 squares",a+8,b+122,16711935),Q("4: Leap 5 squares",a+8,b+130,2155905279))}Va++}};W=O.keys;t=O.v;
