var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a,b){if(b){var c=ba;a=a.split(".");for(var e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}
ca("Math.hypot",function(a){return a?a:function(a,c,e){a=Number(a);c=Number(c);var b,h=Math.max(Math.abs(a),Math.abs(c));for(b=2;b<arguments.length;b++)h=Math.max(h,Math.abs(arguments[b]));if(1E100<h||1E-100>h){if(!h)return h;a/=h;c/=h;var k=a*a+c*c;for(b=2;b<arguments.length;b++){var p=Number(arguments[b])/h;k+=p*p}return Math.sqrt(k)*h}k=a*a+c*c;for(b=2;b<arguments.length;b++)p=Number(arguments[b]),k+=p*p;return Math.sqrt(k)}});
var f=256,g=144,da=f/g,fa=[0,0,16,17,23],ha=[1,5,28,23,27],ia=[2,0,1,3];function m(a,b,c,e){this.A=a;this.B=b;this.D=a+c;this.F=b+e;this.left=this.A;this.top=this.B;this.width=c;this.height=e;this.h=function(){return{x:(this.A+this.D)/2|0,y:(this.B+this.F)/2|0}};this.o=function(){var a=q[ja];return this.A<=a.D&&this.D>=a.A&&this.B<=a.F&&this.F>=a.B}};function ka(){this.c=!1;this.I=this.f=0}ka.prototype.update=function(){this.c?(this.f++,this.I=0):(this.f=0,this.I++)};for(var r=Array(256),la=0;256>la;la++)r[la]=new ka;function ma(a,b){a.stopPropagation();a.preventDefault();a=a.keyCode;0<=a&&256>a&&(r[a].c=b)}window.onload=function(){document.addEventListener("keydown",function(a){ma(a,!0)});document.addEventListener("keyup",function(a){ma(a,!1)})};var t=new ka;t.x=0;t.y=0;t.u=0;t.v=0;function na(a){a.stopPropagation();a.preventDefault();oa(a.clientX,a.clientY);"mousedown"===a.type&&(t.c=!0,u.focus());"mouseup"===a.type&&(t.c=!1)}function pa(a){a.stopPropagation();a.preventDefault();0<a.touches.length?(a=a.touches[0],oa(a.clientX,a.clientY),t.c=!0):t.c=!1}
function oa(a,b){var c=u.getBoundingClientRect(),e=c.width/c.height;if(.01<e-da){var d=da*c.height;c=new m(Math.floor((c.width-d)/2),0,d,c.height)}-.01>e-da&&(e=c.width/da,c=new m(0,Math.floor((c.height-e)/2),c.width,e));e=t.x;d=t.y;t.x=f*(a-c.left)/c.width|0;t.y=g*(b-c.top)/c.height|0;t.u=t.x-e;t.v=t.y-d}function qa(a,b){return t.x>=a&&t.x<a+80&&t.y>=b&&t.y<b+8};var w=null,x=null,y=null,ra=null;function sa(a){var b=a.A,c=a.D,e=a.F;for(a=a.B;a<e;a++)for(var d=b;d<c;d++)ta(d,a,ua(d,a),!1)}function wa(a,b,c){for(var e=Math.min(a,b);e<=Math.max(a,b);e++)ta(e,c,ua(e,c),!1)}function xa(a,b,c){for(var e=Math.min(a,b);e<=Math.max(a,b);e++)ta(c,e,ua(c,e),!1)}function ya(a,b){return Math.floor(Math.random()*(b-a)+a)}function za(a,b){a=a/40|0;b=b/40|0;return 0>a||4<=a||0>b||4<=b?null:y[b][a]}
function ua(a,b){a=(a=za(a,b))?a.level:0;a=1+64*(9+a%3)+(5>a?16:20);return ya(a,a+4)}function Aa(){var a=za(z,A);a=64*(1+(a?a.level:0)%6)+17;return ya(a,a+6)};var Ba=[0,-1,1,0],Ca=[-1,0,0,1],Da=[1,1,1,1];
function Ea(a){for(var b=B.target,c=w,e=0;e<c.height;e++)for(var d=0;d<c.width;d++){var h=c.a[e][d];h.C=Infinity;h.aa=Math.min(Math.abs(d-b.x),Math.abs(e-b.y));h.ea=null}a=w.a[a.y][a.x];a.C=0;for(a=[a];0<a.length;){c=null;e=-1;d=Infinity;for(h=0;h<a.length;h++){var k=a[h];Infinity!==k.C&&k.C+k.aa<d&&(c=k,e=h,d=k.C+k.aa)}a.splice(e,1);if(c.x===b.x&&c.y===b.y){b=[];for(a=c;a;)b.push(a),a=a.ea;b.reverse();return b}for(e=0;e<Ba.length;e++)if(d=c.x+Ba[e],h=c.y+Ca[e],0<=d&&d<w.width&&0<=h&&h<w.height){k=
w.a[h][d];var p=c.C+Da[e];p<k.C&&20>=p&&!w.a[h][d].m&&(k.C=p,k.ea=c,a.push(k))}}return null};function Fa(a,b,c){b=Ga(a,a.VERTEX_SHADER,b);c=Ga(a,a.FRAGMENT_SHADER,c);var e=a.createProgram();a.attachShader(e,b);a.attachShader(e,c);a.linkProgram(e);return e}function Ga(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);return b}
function Ha(){var a=C.createTexture();C.bindTexture(C.TEXTURE_2D,a);var b=C.RGBA,c=C.RGBA,e=C.UNSIGNED_BYTE;C.texImage2D(C.TEXTURE_2D,0,b,1,1,0,c,e,new Uint8Array([0,0,0,0]));var d=new Image;d.onload=function(){C.bindTexture(C.TEXTURE_2D,a);C.texImage2D(C.TEXTURE_2D,0,b,c,e,d);C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE);C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE);C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.NEAREST);C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,
C.NEAREST);C.generateMipmap(C.TEXTURE_2D);a.loaded=!0;a.width=d.width;a.height=d.height};d.src="img/graphics.png";return a};function Ia(a,b){this.x=a;this.y=b;this.ka=0;this.m=!0;this.fa=this.visible=!1;this.aa=this.C=0;this.ea=null}function Ja(){this.height=this.width=256;this.ga=null;this.H=new Uint8Array(262144);this.ua=new Float32Array([256,256]);this.clear()}Ja.prototype.clear=function(){for(var a=0;a<this.H.length;a++)this.H[a]=255};
Ja.prototype.ba=function(a){this.ga=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.ga);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,this.H);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)};
function Ka(){this.height=this.width=256;this.a=Array(256);this.K=Array(3);this.da=new Float32Array(2);for(var a=0;256>a;a++){this.a[a]=Array(256);for(var b=0;256>b;b++)this.a[a][b]=new Ia(b,a)}for(a=0;3>a;a++)this.K[a]=new Ja}
Ka.prototype.ba=function(a){this.oa=a;this.ma=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.ma);a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,-1,0,1,1,1,1,0,-1,1,0,0]),a.STATIC_DRAW);this.o=Fa(a,"precision highp float;attribute vec2 position;attribute vec2 texture;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 viewOffset;uniform vec2 viewportSize;uniform vec2 mapSize;void main(void) {   pixelCoord = (texture * viewportSize) + viewOffset;   texCoord = pixelCoord / mapSize / 16.0;   gl_Position = vec4(position, 0.0, 1.0);}","precision highp float;varying vec2 pixelCoord;varying vec2 texCoord;uniform sampler2D tiles;uniform sampler2D sprites;void main(void) {   vec4 tile = texture2D(tiles, texCoord);   if(tile.x == 1.0 && tile.y == 1.0) { discard; }   vec2 spriteOffset = floor(tile.xy * 256.0) * 16.0;   vec2 spriteCoord = mod(pixelCoord, 16.0);   gl_FragColor = texture2D(sprites, (spriteOffset + spriteCoord) / 1024.0);   gl_FragColor.a = tile.a;}");
this.la=a.getAttribLocation(this.o,"position");this.na=a.getAttribLocation(this.o,"texture");this.ta=a.getUniformLocation(this.o,"viewportSize");this.sa=a.getUniformLocation(this.o,"viewOffset");this.pa=a.getUniformLocation(this.o,"mapSize");this.ra=a.getUniformLocation(this.o,"tiles");this.qa=a.getUniformLocation(this.o,"sprites");for(var b=0;b<this.K.length;b++)this.K[b].ba(a)};
function ta(a,b,c,e){var d=w;d.a[b][a].ka=c;d.a[b][a].m=e;e=d.K[0];a=4*(b*e.width+a);e.H[a]=0===c?255:(c-1)%64|0;e.H[a+1]=0===c?255:(c-1)/64|0}function La(a,b,c){return 0>b||256<=b||0>c||256<=c?null:a.a[c][b]}function Ma(a){return(a=La(w,z,a))?a.ka:81}function F(a,b){a=La(w,a,b);return!a||a.m}Ka.prototype.ca=function(a,b){return(a=La(this,a,b))&&a.visible};Ka.prototype.ca=function(a,b){return a<this.W||a>this.U||b<this.X||b>this.V?!1:this.a[b][a].visible};function Na(){var a=w,b=B.x/16|0,c=B.y/16|0;a.ia=b;a.ja=c;a.W=Math.max(0,b-12);a.X=Math.max(0,c-12);a.U=Math.min(a.width-1,b+12);a.V=Math.min(a.height-1,c+12);for(var e=a.X;e<=a.V;e++)for(var d=a.W;d<=a.U;d++)a.a[e][d].fa|=a.a[e][d].visible,a.a[e][d].visible=!1;a.a[c][b].visible=!0;Oa(a,1,1);Pa(a,1,1);Oa(a,1,-1);Pa(a,1,-1);Oa(a,-1,1);Pa(a,-1,1);Oa(a,-1,-1);Pa(a,-1,-1)}
function Oa(a,b,c){var e=[],d=[],h=1,k=0,p=0,D=0,l,n;for(n=a.ja+c;n>=a.X&&n<=a.V;n+=c,p=k,++h){var W=.5/h;var E=-1;var X=Math.floor(D*h+.5);for(l=a.ia+X*b;X<=h&&l>=a.W&&l<=a.U;l+=b,++X,E=L){var T=!0;var va=!1;var ea=X/h;var L=ea+W;if(0<p)if(a.a[n-c][l].visible&&!a.a[n-c][l].m||a.a[n-c][l-b].visible&&!a.a[n-c][l-b].m)for(var v=0;v<p&&T;++v){if(E<=d[v]&&L>=e[v])if(a.a[n][l].m)if(E>=e[v]&&L<=d[v]){T=!1;break}else e[v]=Math.min(e[v],E),d[v]=Math.max(d[v],L),va=!0;else if(ea>e[v]&&ea<d[v]){T=!1;break}}else T=
!1;T&&(a.a[n][l].visible=!0,a.a[n][l].m&&(D>=E?D=L:va||(e[k]=E,d[k++]=L)))}}}
function Pa(a,b,c){var e=[],d=[],h=1,k=0,p=0,D=0,l,n;for(l=a.ia+b;l>=a.W&&l<=a.U;l+=b,p=k,++h){var W=.5/h;var E=-1;var X=Math.floor(D*h+.5);for(n=a.ja+X*c;X<=h&&n>=a.X&&n<=a.V;n+=c,++X,E=L){var T=!0;var va=!1;var ea=X/h;var L=ea+W;if(0<p)if(a.a[n][l-b].visible&&!a.a[n][l-b].m||a.a[n-c][l-b].visible&&!a.a[n-c][l-b].m)for(var v=0;v<p&&T;++v){if(E<=d[v]&&L>=e[v])if(a.a[n][l].m)if(E>=e[v]&&L<=d[v]){T=!1;break}else e[v]=Math.min(e[v],E),d[v]=Math.max(d[v],L),va=!0;else if(ea>e[v]&&ea<d[v]){T=!1;break}}else T=
!1;T&&(a.a[n][l].visible=!0,a.a[n][l].m&&(D>=E?D=L:va||(e[k]=E,d[k++]=L)))}}};var Qa=null,Ra=null,Sa=null,Ta=null,Ua=null,Va=[f,g],Wa=null,Xa=null,Ya=null,G=null,H=new Float32Array(65536),I=0,J=new Float32Array(65536),K=0,Za=new Uint8Array(65536),$a=new DataView(Za.buffer),ab=0;function M(a,b,c,e){a=a.split("\n");for(var d=0;d<a.length;d++)for(var h=0;h<a[d].length;h++){var k=a[d].charCodeAt(h);33<=k&&127>=k&&N(b+4*h,c+8*d,8*(k-33),0,8,10,e)}}
function N(a,b,c,e,d,h,k,p,D){if(G.loaded){p=a+Math.abs(void 0!==p?p:d);D=b+(void 0!==D?D:h);var l=c/G.width,n=e/G.height;c=(c+d)/G.width;e=(e+h)/G.height;k=k||0;H[I++]=a;H[I++]=b;H[I++]=p;H[I++]=b;H[I++]=a;H[I++]=D;J[K++]=l;J[K++]=n;J[K++]=c;J[K++]=n;J[K++]=l;J[K++]=e;H[I++]=a;H[I++]=D;H[I++]=p;H[I++]=b;H[I++]=p;H[I++]=D;J[K++]=l;J[K++]=e;J[K++]=c;J[K++]=n;J[K++]=c;J[K++]=e;for(a=0;6>a;a++)$a.setUint32(ab,k,!1),ab+=4}};var bb=[{i:"Ok hotshot, teleportation complete.\nSystem check. Do you remember the mission?",options:[{text:"ROGER",j:"dialog",M:4},{text:"UH WHAT?",j:"dialog",M:1}]},{i:"Mother frakking... Teleportation glitch.\nYou're a lost cause. Want advice anyway?",options:[{text:"YES",j:"dialog",M:2},{text:"NO",j:"dialog",M:3}]},{i:"Alright.  Your brain is mush, but we'll try.\nFind the blaster in the room.",options:[{text:"COPY",j:"quest",S:0}]},{i:"Alright.  Your brain is mush, and you're\nballs deep in aliens who want to kill you.  Good luck.",
options:[{text:"BYE"}]},{i:"Good. How do you wanna run this, soldier?\nWant me to guide you, or comms off?",options:[{text:"GUIDE",j:"dialog",M:5},{text:"COMMS OFF",j:"dialog",M:6}]},{i:"Alright.  First things first:\nFind the blaster in the room.",options:[{text:"OK",j:"quest",S:0}]},{i:"Alright.  You know what you're doing.\nGo get em.",options:[{text:"OVER AND OUT"}]},{i:"Good.  Radar shows alien blood nearby.\nGo kill that ugly bastard.",options:[{text:"ACCEPT",j:"quest",S:1},{text:"IGNORE"}]},
{i:"Not bad, soldier.  That took guts.\nFind a BLUE key to get out of this sector.",options:[{text:"ACCEPT",j:"quest",S:2},{text:"IGNORE"}]},{i:"Excellent.  Let's get the frak out of here.\nFind the BLUE door to move to the next sector.",options:[{text:"ACCEPT",j:"quest",S:3},{text:"IGNORE"}]}],cb=!1,db=0,eb=0,fb;var gb=[{title:"Find blaster",N:"item",b:2,P:7},{title:"First blood",N:"kill",b:1,P:8},{title:"Blue keycard",N:"item",b:3,P:9},{title:"Blue door",N:"item",b:3,P:9},{title:"Pick up radio",N:"item",b:4,P:0}],O=[];function hb(a){ib("Quest accepted: "+a.title,4294902015);O.push(a)}function jb(a){ib("Quest complete: "+a.title,4294902015);void 0!==a.P&&(a=a.P,cb=!0,fb=!1,db=a,eb=kb)};var u=null,C=null,lb=0,mb=0,nb=0,kb=0,B=null,P=null,ob=null,pb=null,Q=null,R=null,S=null,qb=!1,rb=!1,sb=0,tb=0,ub=0,vb=0,wb=[],xb=0;function yb(){var a=window.innerWidth,b=window.innerHeight;var c=a>b?Math.max(1,Math.min(Math.floor(a/256),Math.floor(b/144))):Math.max(1,Math.min(Math.floor(a/144),Math.floor(b/256)));f=Math.round(a/c);g=Math.round(b/c);da=f/g;u.width=f;u.height=g;u.style.left="0";u.style.top="0";u.style.width=a+"px";u.style.height=b+"px"}
function zb(a){return a.x+16>=R.x&&a.y+16>=R.y&&a.x<R.x+f&&a.y<R.y+g&&w.ca(a.x/16|0,a.y/16|0)}function Ab(a,b){for(var c=0;c<P.length;c++){var e=P[c];if(!(0>=e.g)&&(e.x/16|0)===a&&(e.y/16|0)===b)return e}return null}
function Bb(){for(var a=Cb.x,b=Cb.y,c=0;20>c;c++){for(var e=a-c;e<=a+c;e++){var d=b-c;if(!F(e,d)&&null===Ab(e,d))return{Z:e,$:d};d=b+c;if(!F(e,d)&&null===Ab(e,d))return{Z:e,$:d}}for(e=b-c;e<=b+c;e++){d=a-c;if(!F(d,e)&&null===Ab(d,e))return{Z:d,$:e};d=a+c;if(!F(d,e)&&null===Ab(d,e))return{Z:d,$:e}}}return null}
function Db(a,b,c,e){a.direction=e;var d=Math.hypot(b,c);e=Math.floor(a.x/16)+b/d;d=Math.floor(a.y/16)+c/d;if(F(e,d))return!1;if(e=Ab(e,d)){if(a.b===e.b)return!1;Eb(a,e,2);a.s=18;wb.push({x:e.x,y:e.y,frame:0});return!0}a.u=b;a.v=c;a.s=16/Math.max(Math.abs(b),Math.abs(c));return!0}
function Eb(a,b,c){b.g-=c;if(0>=b.g&&(b.g=0,ib(b.name+" died",4278190335),b===S&&(S=null),0===a.b)){for(B.J+=10*b.level;B.J>=B.L;)B.J-=B.L,B.L*=2,B.level++,ib("You are now level "+B.level,16711935);for(a=O.length-1;0<=a;a--)c=O[a],"kill"===c.N&&c.b===b.b&&(O.splice(a,1),jb(c))}}function ib(a,b){Q.push({text:a,color:b});5<Q.length&&Q.splice(0,Q.length-5)}
function Fb(){0===nb&&P.sort(function(a,c){return Math.hypot(a.x-B.x,a.y-B.y)-Math.hypot(c.x-B.x,c.y-B.y)});nb++;if(nb>=P.length)for(var a=nb=0;a<P.length;a++)0<P[a].g&&(P[a].l=1)}function Gb(a){if(cb){var b=bb[db];0>a||a>b.options.length||(a=b.options[a],"dialog"===a.j?(a=a.M,cb=!0,fb=!1,db=a,eb=kb):"quest"===a.j?(cb=!1,hb(gb[a.S])):cb=!1)}}
function Hb(){for(var a=0;256>a;a++)r[a].update();t.update();if(cb){if(!(30>kb-eb)){a=(f-160)/2|0;var b=(g-160)/2|0;1===r[32].I?fb=!0:1===r[49].I||1===t.I&&qa(a,b+64)?Gb(0):(1===r[50].I||1===t.I&&qa(a,b+80))&&Gb(1)}}else if(qb)1===r[78].f&&(qb=!1);else if(0<B.g)for(;;){a=P[nb];if(0<a.l&&0===a.s)if(0===nb)a:if(0>=B.g)B.l=0;else{var c=B.x/16|0;b=B.y/16|0;var e=!1;if(0!==t.u||0!==t.v)sb=t.x,tb=t.y,ub=(R.x+sb)/16|0,vb=(R.y+tb)/16|0;if(rb){1===r[98].f||1===r[40].f?(tb+=16,vb++):1===r[100].f||1===r[37].f?
(sb-=16,ub--):1===r[102].f||1===r[39].f?(sb+=16,ub++):1===r[104].f||1===r[38].f?(tb-=16,vb--):1===r[27].f?(B.target=null,B.path=null,rb=!1):1===r[13].f&&(rb=!1);var d=La(w,ub,vb);d!==B.target&&(b={x:c,y:b},B.target=d,B.path=Ea(b),B.O=0)}else{if(t.c)if(t.y>g-24)0<=t.x&&32>t.x&&(e=!0);else{d=ub;var h=vb;if(S=Ab(d,h)){B.target=null;B.path=null;break a}d=La(w,d,h);d!==B.target&&(b={x:c,y:b},B.target=d,B.path=Ea(b),B.O=0);break a}if(1===r[9].f){b=S?P.indexOf(S):0;for(c=b+1;0===c||c>=P.length||0>=P[c].g||
!zb(P[c]);)if(c++,c>=P.length&&(c=0),c===b){c=-1;break}0<c?S=P[c]:S=null}else if(1===r[13].f)sb=B.x-R.x,tb=B.y-R.y,ub=B.x/16|0,vb=B.y/16|0,rb=!0;else if(1===r[78].f)qb=!0;else{d=null;if(B.path){for(d=B.path[B.O];d&&d.x===c&&d.y===b;)B.O++,d=B.O<B.path.length?B.path[B.O]:null;d||(B.target=null,B.path=null)}h=r[100].c||r[37].c||d&&d.x<c;c=r[102].c||r[39].c||d&&d.x>c;var k=r[104].c||r[38].c||d&&d.y<b,p=r[101].c;e=1===r[49].f||e;r[98].c||r[40].c||d&&d.y>b?Db(B,0,B.w,2):h?Db(B,-B.w,0,3):p?B.l=0:c?Db(B,
B.w,0,1):k?Db(B,0,-B.w,0):e&&S&&0<B.T&&(wb.push({x:S.x,y:S.y,frame:0}),B.s=36,Eb(B,S,5),B.T--)}}}else 0>=a.g?a.l=0:zb(a)?B.x<a.x&&Db(a,-a.w,0,3)||B.x>a.x&&Db(a,a.w,0,1)||B.y<a.y&&Db(a,0,-a.w,0)||B.y>a.y&&Db(a,0,a.w,2)||0!==a.u||0!==a.v||(a.l=0):a.l=0;if(0<a.s){if(0!==a.u||0!==a.v)a.x+=a.u,a.y+=a.v;a.s--;if(0===a.s&&(a.u=0,a.v=0,a.l--,0===a.b)){for(b=ob.length-1;0<=b;b--)if(c=ob[b],c.x===a.x&&c.y===a.y)for(ob.splice(b,1),pb.push(c),ib("Picked up: "+c.name,16777215),d=O.length-1;0<=d;d--)h=O[d],"item"===
h.N&&h.b===c.b&&(O.splice(d,1),jb(h));Na()}}0>=a.l&&(a.l=0,Fb());if(0===nb&&0<a.l)break;if(0<a.s)break}r[65].c&&(xb=10);mb++;16<mb&&(mb=0,lb++);C.viewport(0,0,f,g);C.clearColor(0,0,0,1);C.clear(C.COLOR_BUFFER_BIT|C.DEPTH_BUFFER_BIT);if(G&&G.loaded){R.x=Math.max(0,B.x-(f/2|0)+8);R.y=Math.max(0,B.y-(g/2|0)+8);0<xb--&&(R.x+=4*Math.random()-2,R.y+=4*Math.random()-2);ab=K=I=0;if(cb){if(cb&&(a=(f-160)/2|0,b=(g-160)/2|0,N(a+64,b,128,608,32,32),c=bb[db],d=kb-eb,d=fb?c.i.length:Math.min(c.i.length,Math.floor(d/
2)),M(c.i.substr(0,d),a,b+32),d===c.i.length))for(d=0;d<c.options.length;d++)M(c.options[d].text,a,b+64+16*d)}else{a=w;b=R.x;c=R.y;k=f;p=g;if(G.loaded){d=a.oa;d.enable(d.BLEND);d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);d.useProgram(a.o);d.bindBuffer(d.ARRAY_BUFFER,a.ma);d.enableVertexAttribArray(a.la);d.enableVertexAttribArray(a.na);d.vertexAttribPointer(a.la,2,d.FLOAT,!1,16,0);d.vertexAttribPointer(a.na,2,d.FLOAT,!1,16,8);a.da[0]=k;a.da[1]=p;d.uniform2fv(a.ta,a.da);d.activeTexture(d.TEXTURE0);
d.uniform1i(a.qa,0);d.activeTexture(d.TEXTURE1);d.uniform1i(a.ra,1);h=b/16|0;e=c/16|0;k=(b+k)/16|0;p=(c+p)/16|0;for(var D=0;D<a.K.length;D++){for(var l=a.K[D],n=e;n<=p;n++)for(var W=h;W<=k;W++){var E=a.ca(W,n)?255:(E=La(a,W,n))&&E.fa?144:0;l.H[4*(n*l.width+W)+3]=E}d.uniform2f(a.sa,b,c);d.uniform2fv(a.pa,l.ua);d.bindTexture(d.TEXTURE_2D,l.ga);d.texSubImage2D(d.TEXTURE_2D,0,0,0,l.width,l.height,d.RGBA,d.UNSIGNED_BYTE,l.H);d.drawArrays(d.TRIANGLES,0,6)}}B.target&&(a=16*B.target.x-R.x,b=16*B.target.y-
R.y,c=640,F(B.target.x,B.target.y)&&(c=688),N(a,b,c,176,16,16));for(a=0;a<ob.length;a++)b=ob[a],zb(b)&&N(b.x-R.x,b.y-R.y,16*fa[b.b],16*ha[b.b],16,16);for(a=0;a<P.length;a++)b=P[a],zb(b)&&(c=b.x-R.x,d=b.y-R.y,0>=b.g?(h=496,e=432):(h=16*(fa[b.b]+ia[b.direction]),e=16*(ha[b.b]+lb%2)),b===S&&N(c,d,720,176,16,16),N(c,d,h,e,16,16));for(a=wb.length-1;0<=a;a--)b=wb[a],N(b.x-R.x,b.y-R.y,128+16*Math.floor(b.frame/6),304,16,16),b.frame++,18<=b.frame&&wb.splice(a,1);for(b=a=0;b<P.length;b++)c=P[b],c!==B&&0>=
c.g||!zb(c)||(c===B?(d=c.g/c.R,M(c.name,0,a),N(0,a+7,544,208,32,12),N(2,a+9,544,224,8,8,void 0,Math.round(28*d)),M(c.g+"/"+c.R,0,a+10),d=B.T/B.ha,M("AMMO",32,a),N(32,a+7,544,208,32,12),N(34,a+9,552,224,8,8,void 0,Math.round(28*d)),M(c.T+"/"+c.ha,32,a+10),d=B.J/B.L,M("LEVEL "+B.level,64,a),N(64,a+7,544,208,32,12),N(66,a+9,568,224,8,8,void 0,Math.round(28*d)),M(c.J+"/"+c.L,64,a+10)):(d=c.g/c.R,M(c.name,0,a),N(0,a+7,544,208,32,12),N(2,a+9,560,224,8,8,void 0,Math.round(28*d)),M(c.g+"/"+c.R,0,a+10)),a+=
24);if(0<O.length)for(M("OBJECTIVES:",f-60,0),a=0;a<O.length;a++)M(O[a].title,f-60,8+8*a);a=g-24-8*Q.length;for(b=0;b<Q.length;b++)M(Q[b].text,0,a+8*b,Q[b].color);for(a=0;6>a;a++)N(24*a,g-24,512,208,24,24),0===a&&N(24*a+4,g-24+4,256,448,16,16);qb&&(N(0,0,512,256,144,144,128,f,g),a=(f-144)/2|0,b=(g-144)/2|0,N(a,b,512,256,144,144),N(a+10,b+9,480,416,16,16),M("2",a+21,b+19,16711935),N(a+22,b+33,464,416,16,16),M("0",a+33,b+43,16711935),N(a+22,b+57,624,160,16,16),M("0",a+33,b+67,16711935),N(a+22,b+81,
448,416,16,16),M("0",a+33,b+91,16711935),N(a+56,b+9,336,416,16,16),M("0",a+67,b+19,16711935),N(a+68,b+33,336,448,16,16),M("0",a+79,b+43,16711935),N(a+68,b+57,272,400,16,16),M("0",a+79,b+67,16711935),N(a+68,b+81,400,432,16,16),M("0",a+79,b+91,16711935),N(a+102,b+9,128,354,16,16),M("0",a+113,b+19,16711935),N(a+114,b+33,592,160,16,16),M("0",a+125,b+43,16711935),N(a+114,b+57,272,400,16,16),M("0",a+125,b+67,16711935),N(a+114,b+81,352,400,16,16),M("0",a+125,b+91,16711935),M("1: Leap 2 squares",a+8,b+106,
4294967295),M("2: Leap 3 squares",a+8,b+114,4294967295),M("3: Leap 4 squares",a+8,b+122,16711935),M("4: Leap 5 squares",a+8,b+130,2155905279))}G.loaded&&(C.useProgram(Qa),Va[0]=f,Va[1]=g,C.uniform2fv(Ra,Va),C.activeTexture(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,G),C.enableVertexAttribArray(Sa),C.bindBuffer(C.ARRAY_BUFFER,Wa),C.bufferData(C.ARRAY_BUFFER,H,C.DYNAMIC_DRAW),C.vertexAttribPointer(Sa,2,C.FLOAT,!1,0,0),C.enableVertexAttribArray(Ta),C.bindBuffer(C.ARRAY_BUFFER,Xa),C.bufferData(C.ARRAY_BUFFER,
J,C.DYNAMIC_DRAW),C.vertexAttribPointer(Ta,2,C.FLOAT,!1,0,0),C.enableVertexAttribArray(Ua),C.bindBuffer(C.ARRAY_BUFFER,Ya),C.bufferData(C.ARRAY_BUFFER,Za,C.DYNAMIC_DRAW),C.vertexAttribPointer(Ua,4,C.UNSIGNED_BYTE,!0,0,0),C.drawArrays(C.TRIANGLES,0,I/2));kb++}requestAnimationFrame(Hb)}u=document.querySelectorAll("canvas")[0];
if(C=u.getContext("webgl",{alpha:!1,antialias:!1})){C.disable(C.DEPTH_TEST);C.enable(C.BLEND);C.blendFunc(C.SRC_ALPHA,C.ONE_MINUS_SRC_ALPHA);Qa=Fa(C,"uniform vec2 u_viewportSize;attribute vec2 a_position;attribute vec2 a_texCoord;attribute vec4 a_color;varying vec2 v_texCoord;varying vec4 v_color;void main() {vec2 zeroToOne = a_position / u_viewportSize;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;v_color = a_color;}","precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;varying vec4 v_color;void main() {gl_FragColor = texture2D(u_image, v_texCoord);if (gl_FragColor.a < 0.1) discard;if (v_color.a > 0.5) gl_FragColor = v_color;}");
Wa=C.createBuffer();Xa=C.createBuffer();Ya=C.createBuffer();Ra=C.getUniformLocation(Qa,"u_viewportSize");Sa=C.getAttribLocation(Qa,"a_position");Ta=C.getAttribLocation(Qa,"a_texCoord");Ua=C.getAttribLocation(Qa,"a_color");G=Ha();G=Ha();w=new Ka;x=[];y=[];ra=[];for(var Ib=0;4>Ib;Ib++){y.push(Array(4));for(var Jb=0;4>Jb;Jb++)y[Ib][Jb]=null}for(var Kb=0;10>Kb;Kb++){var U={level:Kb,x:0,y:0,parent:null,G:0,children:[],Y:[]};if(0===Kb)U.x=Math.floor(4*Math.random()),U.y=Math.floor(4*Math.random());else{var V=
ra[Math.floor(Math.random()*ra.length)];V.children.push(U);V.G--;U.parent=V;0<V.x&&!y[V.y][V.x-1]&&(U.x=V.x-1,U.y=V.y);0<V.y&&!y[V.y-1][V.x]&&(U.x=V.x,U.y=V.y-1);3>V.x&&!y[V.y][V.x+1]&&(U.x=V.x+1,U.y=V.y);3>V.y&&!y[V.y+1][V.x]&&(U.x=V.x,U.y=V.y+1)}U.rect=new m(40*U.x,40*U.y,40,40);x.push(U);y[U.y][U.x]=U;ra=[];for(var Lb=0;Lb<x.length;Lb++){var Y=x[Lb];Y.G=0;0<Y.x&&!y[Y.y][Y.x-1]&&Y.G++;0<Y.y&&!y[Y.y-1][Y.x]&&Y.G++;3>Y.x&&!y[Y.y][Y.x+1]&&Y.G++;3>Y.y&&!y[Y.y+1][Y.x]&&Y.G++;0<Y.G&&ra.push(Y)}}for(var Mb=
0;Mb<x.length;Mb++){var Z=x[Mb],q=Z.Y,Nb=new m(Z.rect.A+1,Z.rect.h().y-2,5,5);sa(Nb);q.push(Nb);var Ob=new m(Z.rect.D-5,Z.rect.h().y-2,5,5);sa(Ob);q.push(Ob);var Pb=new m(Z.rect.h().x-2,Z.rect.B+1,5,5);sa(Pb);q.push(Pb);var Qb=new m(Z.rect.h().x-2,Z.rect.F-5,5,5);sa(Qb);for(q.push(Qb);10>q.length;){for(var Rb=new m(ya(Z.rect.A+2,Z.rect.D-12-3),ya(Z.rect.B+2,Z.rect.F-8-3),ya(5,12),ya(5,8)),Sb=!1,ja=0;ja<q.length;ja++)if(Rb.o()){Sb=!0;break}Sb||(sa(Rb),q.push(Rb))}var Tb=void 0,Ub=void 0,Vb=void 0,
Wb=q;for(Tb=Wb.length-1;0<Tb;Tb--)Vb=Math.floor(Math.random()*(Tb+1)),Ub=Wb[Tb],Wb[Tb]=Wb[Vb],Wb[Vb]=Ub;for(var Xb=1;Xb<q.length;Xb++){var Yb=q[Xb].h(),Zb=q[Xb-1].h();.5>Math.random()?(wa(Zb.x,Yb.x,Zb.y),xa(Zb.y,Yb.y,Yb.x)):(xa(Zb.y,Yb.y,Zb.x),wa(Zb.x,Yb.x,Yb.y))}Z.parent&&(Z.parent.x<Z.x?wa(Z.rect.A-3,Z.rect.A+3,Z.rect.h().y):Z.parent.x>Z.x?wa(Z.rect.D-3,Z.rect.D+3,Z.rect.h().y):Z.parent.y<Z.y?xa(Z.rect.B-3,Z.rect.B+3,Z.rect.h().x):Z.parent.y>Z.y&&xa(Z.rect.F-3,Z.rect.F+3,Z.rect.h().x))}for(var A=
0;256>A;A++)for(var z=0;256>z;z++)if(F(z,A))if(F(z,A+1))if(0!==Ma(A)&&0===Ma(A+1))ta(z,A,Aa(),!0);else{if(!(F(z,A-1)&&F(z-1,A)&&F(z+1,A)&&F(z-1,A-1)&&F(z+1,A-1)&&F(z-1,A+1)&&F(z+1,A+1))){var $b=za(z,A),ac=64*(1+($b?$b.level:0)%6)+23;ta(z,A,ya(ac,ac+6),!0)}}else ta(z,A,Aa(),!0);B={b:0,name:"Player",x:16*x[0].Y[0].h().x,y:16*x[0].Y[0].h().y,u:0,v:0,direction:2,g:100,R:100,l:1,s:0,w:2,target:null,path:null,O:0,T:100,ha:100,J:0,L:10,level:1};var bc={b:4,name:"Radio",x:B.x+32,y:B.y-32},cc={b:2,name:"Blaster",
x:B.x+32,y:B.y+32};P=[B];ob=[bc,cc];pb=[];Q=[];R={x:0,y:0};S=null;for(var dc=0;dc<x.length;dc++)for(var ec=x[dc],fc=ec.Y,gc=1;gc<fc.length;gc++){for(var Cb=fc[gc].h(),hc=ec.level/3|1,ic=0;ic<hc;ic++){var jc=Bb();if(!jc)break;P.push({b:1,level:ec.level+1,name:"Alien ("+(ec.level+1)+")",x:16*jc.Z,y:16*jc.$,u:0,v:0,direction:2,g:10+5*ec.level,R:10+5*ec.level,l:1,s:0,w:4})}8===gc&&ob.push({b:3,name:"Blue Key",x:16*Cb.x+32,y:16*Cb.y+32})}Na();hb(gb[4]);w.ba(C);window.addEventListener("resize",yb,!1);yb();
var kc=u;kc.addEventListener("mousedown",na);kc.addEventListener("mouseup",na);kc.addEventListener("mousemove",na);kc.addEventListener("contextmenu",na);kc.addEventListener("touchstart",pa);kc.addEventListener("touchend",pa);kc.addEventListener("touchcancel",pa);kc.addEventListener("touchmove",pa);requestAnimationFrame(Hb)};
